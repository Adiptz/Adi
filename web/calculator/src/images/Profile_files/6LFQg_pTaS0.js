if (self.CavalryLogger) { CavalryLogger.start_js(["xvHL2"]); }

__d("AppSectionCurationState",[],(function(a,b,c,d,e,f){e.exports={hide:"hide",showItems:"show_items",showApps:"show_apps"}}),null);
__d("AggregatedMapCalloutOrientation",[],(function(a,b,c,d,e,f){a={};Object.assign(a,{TOP:"fbMapCalloutUseArrowTop",LEFT:"fbMapCalloutUseArrowLeft",RIGHT:"fbMapCalloutUseArrowRight",BOTTOM:"fbMapCalloutUseArrowBottom",ALWAYS_ON_MAP:"alwaysOnMap"});e.exports=a}),null);
__d("AggregatedMapCallout",["AggregatedMapCalloutOrientation","CSS","DOM","Style","Vector"],(function(a,b,c,d,e,f){var g=16,h=10,i=10;function a(a,c,d){this.map=a;this.contentContainer=null;this.width=null;this.height=null;this.anchor=null;this.orientation=b("AggregatedMapCalloutOrientation").RIGHT;this.arrowYOffset=null;this.arrowXOffset=null;this.border=c;this.contentContainer=(d=b("DOM")).find(this.border,".fbMapCalloutContent");this.arrowWrap=d.find(this.border,".fbMapCalloutArrowWrap");this.arrowL=d.find(this.border,".fbMapCalloutArrowLeft");this.arrowR=d.find(this.border,".fbMapCalloutArrowRight");this.arrowT=d.find(this.border,".fbMapCalloutArrowTop");this.arrowB=d.find(this.border,".fbMapCalloutArrowBottom");this._updateDimensions()}Object.assign(a.prototype,{setOrientation:function(a){this.orientation=a},getOrientation:function(){return this.orientation},getRoot:function(){return this.border},getAnchor:function(){return this.anchor},close:function(){this.anchor=null,this._map_updatePosition()},updateAnchor:function(a){this.anchor=a,this._map_updatePosition()},setContent:function(a){b("DOM").setContent(this.contentContainer,a),this._updateDimensions()},getContent:function(){return this.contentContainer},recalculateArrowYOffset:function(a){if(!this.anchor)return;a=this.map._callout_determineArrowYOffset(this,a,this.width,this.height);this.setArrowYOffset(a);this._map_updatePosition()},_updateDimensions:function(){b("CSS").show(this.border),this.width=b("Vector").getElementDimensions(this.border).x,this.height=b("Vector").getElementDimensions(this.border).y,this.setArrowXOffset(this.width/2),this.setArrowYOffset(this.height/2),b("CSS").hide(this.border)},_map_moveTo:function(a,b){this.anchor=a,this.map._callout_panTo(a,this,b),this._map_updatePosition()},_map_updatePosition:function(){var a=this.anchor&&this.map._callout_getAnchorBounds(this.anchor);if(a===null){b("CSS").hide(this.border);return}var c,d,e,f,g=h,j=this.orientation;if(this.orientation===b("AggregatedMapCalloutOrientation").ALWAYS_ON_MAP){var k=a.getCenter().x,l=a.getCenter().y;k<0&&l<0?(d=i,c=i):k>this.map.ww&&l<0?(e=i,c=i):k>this.map.ww&&l>this.map.hh?(e=i,f=i):k<0&&l>this.map.hh?(d=i,f=i):k<0?(j=b("AggregatedMapCalloutOrientation").RIGHT,d=i,c=a.calloutY-this.arrowYOffset):k>this.map.ww?(j=b("AggregatedMapCalloutOrientation").LEFT,e=i,c=a.calloutY-this.arrowYOffset):l<0?(j=b("AggregatedMapCalloutOrientation").BOTTOM,c=i,d=(a.l+a.r)/2-this.arrowXOffset):l>this.map.hh?(j=b("AggregatedMapCalloutOrientation").TOP,f=i,d=(a.l+a.r)/2-this.arrowXOffset):(c=a.calloutY-this.arrowYOffset,k<this.map.ww/2?(d=a.r+g,j=b("AggregatedMapCalloutOrientation").RIGHT):(d=a.l-g-this.width,j=b("AggregatedMapCalloutOrientation").LEFT))}switch(this.orientation){case b("AggregatedMapCalloutOrientation").LEFT:d=a.l-g-this.width;c=a.calloutY-this.arrowYOffset;break;case b("AggregatedMapCalloutOrientation").RIGHT:d=a.r+g;c=a.calloutY-this.arrowYOffset;break;case b("AggregatedMapCalloutOrientation").TOP:f=this.map._getH()-a.t+g;d=(a.l+a.r)/2-this.arrowXOffset;break;case b("AggregatedMapCalloutOrientation").BOTTOM:c=a.b+g;d=(a.l+a.r)/2-this.arrowXOffset;break}b("CSS").setClass(this.arrowWrap,j);this._setPosition("top",c);this._setPosition("right",e);this._setPosition("bottom",f);this._setPosition("left",d);b("CSS").show(this.border)},_setPosition:function(a,c){c!==void 0?c+="px":c="auto",b("Style").set(this.border,a,c)},setArrowXOffset:function(a){this.arrowXOffset=a,a-=Math.round(g/2),b("Style").set(this.arrowT,"left",a+"px"),b("Style").set(this.arrowB,"left",a+"px")},setArrowYOffset:function(a){this.arrowYOffset=a,a-=Math.round(g/2),b("Style").set(this.arrowL,"top",a+"px"),b("Style").set(this.arrowR,"top",a+"px")}});Object.assign(a,{throbber:function(a){a=a||this.DEFAULT_CALLOUT_WIDTH;var c=b("DOM").create("div",{}),d=b("DOM").create("img",{src:"/images/loaders/indicator_blue_small.gif"});b("CSS").setClass(c,"fbAggregatedMapCalloutThrobberDiv");b("Style").set(c,"width",a+"px");b("CSS").setClass(d,"fbAggregatedMapCalloutThrobber");b("DOM").setContent(c,d);return c},ARROW_HEIGHT_PLUS_PADDING:h,ARROW_WIDTH:g});e.exports=a}),null);
__d("AggregatedMapMarker",["DOM","Style"],(function(a,b,c,d,e,f){function a(a,b){this._root=a,this._sprite=b}Object.assign(a.prototype,{setPosition:function(a){var c=a.y-this._sprite.getAnchorY();a=a.x-this._sprite.getAnchorX();b("Style").set(this._root,"top",Math.round(c)+"px");b("Style").set(this._root,"left",Math.round(a)+"px")},setOnClick:function(a){this._root.onclick=a},setOnMouseover:function(a){this._root.onmouseover=a},setOnMouseout:function(a){this._root.onmouseout=a},remove:function(){b("DOM").remove(this._root)},getElement:function(){return this._root}});e.exports=a}),null);
__d("AggregatedMapZIndex",[],(function(a,b,c,d,e,f){a={};Object.assign(a,{DEFAULT_PIN_BASE_Z_INDEX:1e3,PIN_Z_INDEX_MAXIMUM_ADD:4e3,DEFAULT_PIN_MAX_Z_INDEX:5e3,CONTROLS_Z_INDEX:7e3,CALLOUT_Z_INDEX:9e3,TOOLTIP_Z_INDEX:9100});e.exports=a}),null);
__d("LegacyMapUtils",["clamp","mod"],(function(a,b,c,d,e,f){"use strict";var g={MIN_LATITUDE:-85.05112878,MAX_LATITUDE:85.05112878,MIN_LONGITUDE:-180,MAX_LONGITUDE:180,pows:{},MAX_ZOOM:20,BING_MAP_ZOOM_LEVEL_CITY:10,BING_MAP_ZOOM_LEVEL_REGION:6,EARTH_CIRCUMFERENCE_METERS:40074784,scale:function(a,b){b=b-a;g.pows[b]||(g.pows[b]=Math.pow(2,b));return g.pows[b]},mapSize:function(a){return 512*g.scale(1,a)},latLongToXY:function(a,c){var d=b("clamp")(a.latitude,g.MIN_LATITUDE,g.MAX_LATITUDE);a=(a.longitude+180)/360;d=Math.sin(d*Math.PI/180);d=.5-Math.log((1+d)/(1-d))/(4*Math.PI);c=g.mapSize(c);return{x:Math.floor(a*(c-1)+.5),y:Math.floor(d*(c-1)+.5)}},xyToLatLong:function(a,c){c=g.mapSize(c);var d=b("mod")(a.x,c)/c-.5;a=.5-b("clamp")(a.y,0,c-1)/c;c=90-360*Math.atan(Math.exp(-a*2*Math.PI))/Math.PI;a=360*d;return{latitude:c,longitude:a}},getViewForLatLongs:function(a,b,c,d,e,f){if(!c.length)throw new Error("the proper view for zero point(s) is completely ambiguous");d=d||{t:0,r:0,b:0,l:0};e=e||1;f=f||Infinity;var h=g._getBoundingBox(c),i=d.l+d.r,j=d.t+d.b,k=g.MAX_ZOOM;if(c.length>1){c=g.mapSize(k);while(k>e&&(g._getWidth(h,c)>a-i||h.b-h.t>b-j)||k>f)h=g._rectScale(h,1,2),k--,c=g.mapSize(k)}else while(k!==g.BING_MAP_ZOOM_LEVEL_CITY)k--,h=g._rectScale(h,1,2);c=h.l-d.l;f=h.r+d.r;f<c&&(f+=g.mapSize(k));e={t:h.t-d.t,r:f,b:h.b+d.b,l:c};g.mapSize(k);i={x:(e.l+e.r)/2,y:(e.t+e.b)/2};j=g.xyToLatLong(i,k);return{center:j,width:a,height:b,zoom:k}},_getWidth:function(a,b){return g._calculateRightDistanceAToB(a.l,a.r,b)},_getBoundingBox:function(a){var b=[],c=g.mapSize(g.MAX_ZOOM);for(var d=0;d<a.length;d++){var e=a[d];b.push(g.latLongToXY(e,g.MAX_ZOOM))}b.sort(function(a,b){return a.x-b.x});e=b.length-1;d=g._calculateRightDistanceAToB(b[e].x,b[0].x,c);a=0;e=e;var f=[b[0].y];for(var h=1;h<b.length;h++){f.push(b[h].y);var i=g._calculateRightDistanceAToB(b[h-1].x,b[h].x,c);i>d&&(d=i,a=h,e=h-1)}i={t:Math.min.apply(null,f),r:b[e].x,b:Math.max.apply(null,f),l:b[a].x};return i},_calculateRightDistanceAToB:function(a,b,c){if(!c)throw new Error("zero or null map width not allowed");return(c+b-a)%c},_rectScale:function(a,b,c){return{t:a.t*b/c,r:a.r*b/c,b:a.b*b/c,l:a.l*b/c}}};e.exports=g}),null);
__d("LegacyMapCoordinate",["LegacyMapUtils","Vector","mod"],(function(a,b,c,d,e,f){a=function(){"use strict";function a(){this.absoluteX=null,this.absoluteY=null,this.latitude=null,this.longitude=null}a.fromAbsolute=function(c,d){d===void 0&&(d=c.y,c=c.x);var e=new a();e.absoluteX=c;e.absoluteY=d;c=b("LegacyMapUtils").xyToLatLong(new(b("Vector"))(c,d),a.MAX_ZOOM);e.latitude=c.latitude;e.longitude=c.longitude;return e};a.fromLatLong=function(c,d){d===void 0&&(d=c.longitude,c=c.latitude);var e=new a();e.latitude=c;e.longitude=d;c=b("LegacyMapUtils").latLongToXY({latitude:c,longitude:d},a.MAX_ZOOM);e.absoluteX=c.x;e.absoluteY=c.y;return e};a.fromMap=function(c,d,e){e=b("LegacyMapUtils").scale(e,a.MAX_ZOOM);return a.fromAbsolute(c*e,d*e)};var c=a.prototype;c.getLatitude=function(){return this.latitude};c.getLongitude=function(){return this.longitude};c.getAbsoluteX=function(){return this.absoluteX};c.getAbsoluteY=function(){return this.absoluteY};c.getAbsoluteXY=function(){return new(b("Vector"))(this.absoluteX,this.absoluteY)};c.getMapX=function(a){return this.getMapXY(a).x};c.getMapY=function(a){return this.getMapXY(a).y};c.getMapXY=function(c){c=b("LegacyMapUtils").scale(a.MAX_ZOOM,c);var d=this.absoluteX*c;c=this.absoluteY*c;return new(b("Vector"))(d,c)};c.add=function(b,c){var d=this.getMapXY(b);return a.fromMap(d.x+c.x,d.y+c.y,b)};c.calculateDistanceSq=function(a,b){var c=this.calculateDistanceX(a,b);a=this.calculateDistanceY(a,b);return c*c+a*a};c.calculateDistanceX=function(a,c){var d=b("LegacyMapUtils").mapSize(a);c=b("mod")(c.getMapX(a)-this.getMapX(a),d);return Math.min(c,d-c)};c.calculateDistanceY=function(a,b){return Math.abs(b.getMapY(a)-this.getMapY(a))};return a}();Object.assign(a,{MAX_ZOOM:18,MIN_ZOOM:1});e.exports=a}),null);
__d("AggregatedMapGroup",["AggregatedMapMarker","AggregatedMapZIndex","DOM","LegacyMapCoordinate","Rect","Style","clamp"],(function(a,b,c,d,e,f){function a(a,b,c,d){this._boundingBox=b,this._sprite=c,this._marker=null,this._mapToPixel=d,this.pins=a,this.deleted=!1}Object.assign(a.prototype,{getType:function(){return"AggregatedMapGroup"},getCenter:function(){return this._mapToPixel(this._boundingBox.getCenter())},getCenterLatLong:function(a){var c=this._boundingBox.getCenter();c=b("LegacyMapCoordinate").fromMap(c.x,c.y,a);return{latitude:c.getLatitude(),longitude:c.getLongitude()}},hasMarker:function(){return!!this._marker},dismissMarker:function(){this._marker&&(this._marker.remove(),this._marker=null)},getMarker:function(){return this._marker&&this._marker.getElement()},getSprite:function(){return this._sprite},updatePosition:function(a){if(!this._marker)return;a=this.getCenter();this._marker.setPosition(a)},getSpriteBounds:function(){var a=this._sprite,c=this.getCenter().y-a.getAnchorY(),d=this.getCenter().x-a.getAnchorX(),e=d+a.getWidth(),f=c+a.getHeight();e=new(b("Rect"))(c,e,f,d);e.calloutY=c+a.getCalloutY();return e},isSinglePin:function(){return this.pins.length==1},renderMarker:function(a){if(!this._marker){var c=this._sprite,d=c.render();this._marker=new(b("AggregatedMapMarker"))(d,this._sprite);if(this.isSinglePin()){var e=c.getBaseZIndex&&c.getBaseZIndex()||b("AggregatedMapZIndex").DEFAULT_PIN_BASE_Z_INDEX;e+=b("clamp")(Math.floor(this.getCenter().y),0,b("AggregatedMapZIndex").PIN_Z_INDEX_MAXIMUM_ADD);c.setZIndex?c.setZIndex(Math.floor(e)):b("Style").set(d,"z-index",Math.floor(e))}b("DOM").appendContent(a,d)}return this._marker},add:function(a,b){return this._boundingBox.add(a,b)}});e.exports=a}),null);
__d("GeoRectangle",["GeoCoordinates","ImmutableObject"],(function(a,b,c,d,e,f){var g=function(b){"use strict";babelHelpers.inheritsLoose(a,b);function a(a,c,d,e){return b.call(this,{n:a,w:c,s:d,e:e})||this}var c=a.prototype;c.containsLat=function(a){return a>=this.s&&a<=this.n};c.getCenter=function(){var a=(this.n+this.s)/2,b;b=(this.e+this.w)/2;this.w>this.e&&(b-=180,b<-180&&(b+=360));return{latitude:a,longitude:b}};c.containsLon=function(a){return this.w>this.e?a>=this.w||a<=this.e:a>=this.w&&a<=this.e};c.getHeight=function(){return this.n-this.s};c.getWidth=function(){var a=this.e;this.w>this.e&&(a+=360);return a-this.w};c.containsPoint=function(a,b){return this.containsLat(a)&&this.containsLon(b)};c.containsGeoRectangle=function(a){return this.containsPoint(a.n,a.w)&&this.containsPoint(a.s,a.e)};c.toArray=function(){return{n:this.n,w:this.w,s:this.s,e:this.e}};return a}(b("ImmutableObject"));g.fromPoints=function(a){if(!a||a.length===0)return null;if(a.length===1){var b=a[0];return new g(b.latitude,b.longitude,b.latitude,b.longitude)}b=a.map(function(a){return a.latitude});a=a.map(function(a){return a.longitude}).sort(function(a,b){return a-b});var c=360+a[0]-a[a.length-1],d=a.length-1,e=0;for(var f=0;f<a.length-1;f++){var h=a[f+1]-a[f];h>c&&(c=h,d=f,e=f+1)}return new g(Math.max.apply(Math,b),a[e],Math.min.apply(Math,b),a[d])};e.exports=g}),null);
__d("MapAggregation",["removeFromArray"],(function(a,b,c,d,e,f){function a(){this.combine=null,this.iterations=0,this.candidates=null,this.loners=null}Object.assign(a.prototype,{aggregate:function(a,c,d){this.overlap=d?d:this._overlap;this.candidates=a;this.combine=c;this.loners=[];while(this.candidates.length>0){d=this.candidates[this.candidates.length-1];do{a=d.center;this._group(d,Number.MAX_VALUE);c=a!==d.center}while(!this._isDeleted(d)&&c);this._isDeleted(d)||(b("removeFromArray")(this.candidates,d),this.loners.push(d))}return this.loners},_isDeleted:function(a){return a.center===null},_delete:function(a){b("removeFromArray")(this.candidates,a),b("removeFromArray")(this.loners,a),a.center=null},_group:function(a,b){while(!0){this.iterations++;if(this.iterations>=1e4){this.iterations%1e4===0&&0;return}var c=this._nearest(a),d=c.nearest;c=c.distanceSquared;if(!d||c>b||!this.overlap(a,d))return;var e=d.center,f=a.center;this._group(d,c-1);if(this._isDeleted(a))return;c=d.center!==e;e=a.center!==f;if(!c&&!e){this.combine(a,d);this._delete(d);return}}},_nearest:function(a){var b,c,d,e=null,f=Number.MAX_VALUE;for(b=0;b<this.candidates.length;b++){d=this.candidates[b];if(d===a)continue;c=this._distanceSquared(a,d);c<f&&(e=d,f=c)}for(b=0;b<this.loners.length;b++){d=this.loners[b];if(d===a)continue;c=this._distanceSquared(a,d);c<f&&(e=d,f=c)}return{nearest:e,distanceSquared:f}},_overlap:function(a,b){var c=a.radius+b.radius;return this._distanceSquared(a,b)<c*c},_distanceSquared:function(a,b){var c=a.center.x-b.center.x;a=a.center.y-b.center.y;return c*c+a*a}});e.exports=a}),null);
__d("MapRects",["Rect","Vector","clamp"],(function(a,b,c,d,e,f){function g(){}Object.assign(g,{containsPoint:function(a,b,c){c===void 0&&(c=0);c===void 0&&(c=0);return a.t<=b.y+c&&a.r>=b.x-c&&a.b>=b.y-c&&a.l<=b.x+c},pad:function(a,b){return g.padXY(a,b,b)},padX:function(a,b){return g.padXY(a,b,0)},padY:function(a,b){return g.padXY(a,0,b)},padXY:function(a,c,d){return new(b("Rect"))(a.t-d,a.r+c,a.b+d,a.l-c,a.domain)},collides:function(a,b){return a.t<b.b&&a.b>b.t&&a.l<b.r&&a.r>b.l},boundPoint:function(a,c){var d=new(b("Vector"))(0,0);d.x=b("clamp")(c.x,a.l,a.r);d.y=b("clamp")(c.y,a.t,a.b);return d},boundingBox:function(a,c){return new(b("Rect"))(Math.min(a.t,c.t),Math.max(a.r,c.r),Math.max(a.b,c.b),Math.min(a.l,c.l))},scale:function(a,c,d){return new(b("Rect"))(a.t*c/d,a.r*c/d,a.b*c/d,a.l*c/d)}});e.exports=g}),null);
__d("AggregatedMap",["csx","AggregatedMapCallout","AggregatedMapCalloutOrientation","AggregatedMapGroup","AggregatedMapZIndex","Arbiter","CSS","DOM","Event","GeoRectangle","LegacyMapCoordinate","LegacyMapUtils","MapAggregation","MapRects","Rect","Run","Style","Vector","$","clamp","leaflet"],(function(a,b,c,d,e,f,g){var h=10,i=7,j=100,k=50,l=500,m=409,n=90,o=90,p=.15,q=10,r=10,s=10,t=new(b("Rect"))(50,50,50,50);function u(a,c,d,e,f,g,i){this.mapReady=!1,this.lastZoom=null,this.initialView=null,this.lastRender=null,this.visiblePins=[],this.groups=[],this.callouts=[],this.zoomStack=[],this.initialPinsToHide=[],this.arrowYOffset=o,this.padding=j+k,this.topLeft=b("LegacyMapCoordinate").fromLatLong(0,0),this.dynamicMap=a,this.canvas=c,this.instanceid=d,this.logger=g,this.maxZoom=e.maxZoom,this.minZoom=e.minZoom,this.maxCalloutWidth=e.maxCalloutWidth||e.width-h,this.maxCalloutHeight=e.maxCalloutHeight||e.height-h,this.pad={},this.setViewportPadding(e.paddingTop,e.paddingRight,e.paddingBottom,e.paddingLeft),this.listeners=[],this.bingMapEvents=[],b("Run").onLeave(this._onBeforeLeave.bind(this)),this.dynamicMap.onInit(this._onInit.bind(this,f,i))}Object.assign(u.prototype,{CALLOUT_MARGIN:10,noPanningStrategy:function(a){return this._noPan.bind(this,a)},leftRightNoPanningStrategy:function(){return this._leftRightNoPan.bind(this)},anchoredPanningStrategy:function(a,b){return this._anchoredPan.bind(this,a,b)},smartPanningStrategy:function(a,b){return this._smartPan.bind(this,a,b)},getMap:function(){this._assertInitialized();return this.map},setPins:function(a){this._assertInitialized(),this.visiblePins=a,this.calloutAnchor=null,this._setZoomButtonVisibility(),this._aggregate()},getGroups:function(){return this.groups},getWidth:function(){return this._getW()-this.pad.l-this.pad.r},getAbsoluteWidth:function(){return this._getW()},getHeight:function(){return this._getH()-this.pad.t-this.pad.b},getAbsoluteHeight:function(){return this._getH()},getBounds:function(){var a=this.dynamicMap.getBounds();return new(b("GeoRectangle"))(a.getNorth(),a.getWest(),a.getSouth(),a.getEast())},pushView:function(){this._assertInitialized(),this.zoomStack.push(this._getMapView())},invalidateSize:function(){this.dynamicMap.invalidateSize()},zoomIntoOne:function(a,b){this._assertInitialized(),this.pushView(),this.zoomToOne(a,b)},zoomToOne:function(a,b,c){this.zoomToOneTight(a,b,0,c)},zoomToOneTight:function(a,c,d,e){this._assertInitialized();c=c||new(b("Vector"))(0,0);d=d||0;e=e||!1;d=Math.max(this._findMinZoomWherePinIsAlone(a),d,this.getZoom());a.setZoom(d);a=a.anchor.add(d,c.mul(-1));this._setMapView({zoom:d,center:{latitude:a.getLatitude(),longitude:a.getLongitude()},animate:e},"persistent")},zoomInto:function(a){this._assertInitialized(),this.pushView(),this.zoomTo(a)},removePin:function(a){this._assertInitialized(),this.removePins([a])},removePins:function(a){this._assertInitialized();for(var b=0;b<a.length;b++)a[b]._aggregated_map_remove=!0;b=[];for(var c=0;c<this.visiblePins.length;c++)this.visiblePins[c]._aggregated_map_remove||b.push(this.visiblePins[c]);for(var c=0;c<a.length;c++)delete a[c]._aggregated_map_remove;this.visiblePins=b;this._aggregate()},addPins:function(a){this._assertInitialized();this.visiblePins=this.visiblePins||[];for(var b=0;b<a.length;b++)this.visiblePins.push(a[b]);this._aggregate()},addPin:function(a){this._assertInitialized(),this.addPins([a])},zoomOut:function(){this._assertInitialized(),this.logger&&this.logger.bumpTap("zoom-out"),this.zoomDelta(-1,!0)},zoomIn:function(){this._assertInitialized(),this.logger&&this.logger.bumpTap("zoom-in"),this.zoomDelta(1,!0)},zoomBack:function(){this._assertInitialized();this.logger&&this.logger.bumpTap("snap-back");var a;this.zoomStack.length?a=this.zoomStack.pop():(a={},Object.assign(a,this.initialView),a.zoom=Math.min(a.zoom,this.getZoom()));this._setMapView(a)},setInitialView:function(){this._assertInitialized();this.initialView=this._getMapView();var a=b("DOM").scry(this.canvas,"span.__0")[0];a&&b("CSS").hide(a)},closeCalloutAndZoomBack:function(){this._assertInitialized(),this.hideCallout(),this.zoomBack()},onAddPin:function(a,b){a=b.pin;b=b.content;this.hideCallout();this.addPin(a);this.zoomIntoOne(a);this.openCallout(a,b)},zoomDelta:function(a,c){a=b("clamp")(this.getZoom()+a,this.minZoom,this.maxZoom)-this.getZoom();if(!a)return;var d=null;if(c&&this._getPrimaryCalloutAnchorGroup()){d=this._getPrimaryCalloutAnchorGroup().getCenter();c=!b("MapRects").containsPoint(new(b("Rect"))(0,this._getW(),this._getH(),0),d);c&&(d=null)}d===null&&(d={x:this._getW()/2+this._getCenterOffset().x,y:this._getH()/2+this._getCenterOffset().y});c=this.map.tryPixelToLocation(b("leaflet").point(d.x,d.y));d=b("leaflet").point(d.x-this.map.getWidth()/2,d.y-this.map.getHeight()/2);this._zoom(!0,a,c,d)},getZoom:function(){return this.map.getZoom()},getCenter:function(){return this.map.getCenter()},getView:function(){return this._getMapView()},setView:function(a){this._assertInitialized(),this._setMapView(a)},setViewportPadding:function(a,b,c,d){this.pad.t=a,this.pad.r=b,this.pad.b=c,this.pad.l=d},redraw:function(){this._assertInitialized(),this._aggregate()},zoomTo:function(a,c){this._assertInitialized();if(a.length<1)return;var d=this.maxZoom;if(a.length<q)while(this._aggregateZoom(a,d-1).length==a.length&&d>=r)d--;var e=[];for(var f=0;f<a.length;f++){var g={latitude:a[f].getLatitude(),longitude:a[f].getLongitude()};e.push(g)}g=b("LegacyMapUtils").getViewForLatLongs(this._getW(),this._getH(),e,t,this.minZoom,d);delete g.height;delete g.width;g.animate=c;this._setMapView(g,"persistent")},hideCallout:function(a){this._assertInitialized();var b=this._getPrimaryCalloutAnchor();this._getInternalCallout().close();b&&!a&&this._inform("calloutHidden")},throbber:function(a){a=a||m;return b("AggregatedMapCallout").throbber(a)},openCallout:function(a,b,c){this._getTooltipCallout().getAnchor()===a&&this._getTooltipCallout().close();this._getInternalCallout().setContent(b);this._getInternalCallout()._map_moveTo(a,c);return this._getInternalCallout()},getCallout:function(){return this._getInternalCallout()},setExternalCalloutAnchor:function(a){this._externalCalloutAnchor=a},openTooltip:function(a,b,c){if(this._getInternalCallout().getAnchor()===a)return;this._getTooltipCallout().setContent(b);this._getTooltipCallout()._map_moveTo(a,c);return this._getTooltipCallout()},getTooltip:function(){return this._getTooltipCallout()},updateCallouts:function(){for(var a=0;a<this.callouts.length;a++)this.callouts[a]._map_updatePosition()},_onInit:function(a,c){this.map=this.dynamicMap;this.bingMapEvents=[{name:"movestart move",callback:this._onViewChange},{name:"moveend",callback:this._onViewChangeEnd},{name:"mouseup",callback:this._onMouseUp},{name:"mousedown",callback:this._onMouseDown},{name:"zoomstart",callback:this._onZoomStart}];this.bingMapEvents.forEach(function(a){this.map.on(a.name,a.callback,this)},this);this._onViewChange();this.initialized=!0;for(var d=0;d<a.length;d++)a[d].xhp&&this.initialPinsToHide.push(a[d].xhp);a.length&&this.setPins(a);c&&(a[0].setCallout(b("$")(c)),this._getInternalCallout()._map_moveTo(a[0],this.noPanningStrategy(b("AggregatedMapCalloutOrientation").TOP)));b("CSS").hide(b("DOM").scry(this.canvas,".fbAggregatedMapCalloutShell")[0]);for(var e in u.Listeners)this._subscribe("AggregatedMap/"+e,this[e].bind(this));this._inform(u.Events.ready,this,"state")},_callout_getAnchorBounds:function(a){a=this._getCalloutAnchorGroup(a);a=a&&a.getSpriteBounds();return a},_callout_panTo:function(a,c,d){a=this._callout_getAnchorBounds(a);d=d?d(c,a):null;if(d){c=b("LegacyMapUtils").xyToLatLong(this.dynamicMap.pixelToMap(d),this.getZoom());this._setMapView({center:c})}},_callout_determineArrowYOffset:function(a,c,d,e){d=this._callout_getAnchorBounds(a.getAnchor());a=new(b("Vector"))((d.l+d.r)/2,d.calloutY);d=e/2;var f=this._getVisibleBounds(),g=b("MapRects").containsPoint(this._getNoPanBounds(e),a,1),h=d;if(c||g){c=f.t+d+this.CALLOUT_MARGIN;g=f.b-(e-d)-this.CALLOUT_MARGIN;h+=a.y-b("clamp")(a.y,c,g)}h=b("clamp")(h,b("AggregatedMapCallout").ARROW_WIDTH/2,e-b("AggregatedMapCallout").ARROW_WIDTH/2);return h},_createCallout:function(a){var c=b("DOM").scry(this.canvas,".fbAggregatedMapCalloutShell")[0];c=c.cloneNode(!0);b("DOM").appendContent(this.canvas,c);b("Style").set(c,"z-index",a);a=new(b("AggregatedMapCallout"))(this,c);this.callouts.push(a);return a},_getInternalCallout:function(){this.internalCallout=this.internalCallout||this._createCallout(b("AggregatedMapZIndex").CALLOUT_Z_INDEX);return this.internalCallout},_getTooltipCallout:function(){this.tooltipCallout=this.tooltipCallout||this._createCallout(b("AggregatedMapZIndex").TOOLTIP_Z_INDEX);return this.tooltipCallout},_assertInitialized:function(){},_guard:function(a){return function(b,c){if(!(!c||!c._instanceid))if(c._instanceid===this.instanceid)return a(b,c)}.bind(this)},_subscribe:function(a,c){this.listeners.push(b("Arbiter").subscribe(a,this._guard(c)))},_inform:function(a,c,d){c=c||{},c._instanceid=this.instanceid,b("Arbiter").inform("AggregatedMap/"+a,c,d)},_bubbleClick:function(a){this._inform(u.Events.bubbleClick,a)},_bubbleMouseover:function(a){this._inform(u.Events.bubbleMouseover,a)},_bubbleMouseout:function(a){this._inform(u.Events.bubbleMouseout,a)},_pinClick:function(a){a._agg_map_callout&&(this.getCallout().getAnchor()===a?this.hideCallout():this.openCallout(a,a._agg_map_callout)),this._inform(u.Events.pinClick,a)},_pinMouseover:function(a){if(a.name){var c=b("DOM").create("span");b("CSS").addClass(c,"fbAggregatedMapTooltipText");b("DOM").setContent(c,a.name);this.openTooltip(a,c,this.leftRightNoPanningStrategy())}this._inform(u.Events.pinMouseover,a)},_pinMouseout:function(a){this.tooltipCallout&&this.tooltipCallout.getAnchor()===a&&a.name&&this.tooltipCallout.close(),this._inform(u.Events.pinMouseout,a)},_getVisibleBounds:function(){return new(b("Rect"))(this.pad.t,this._getW()-this.pad.r,this._getH()-this.pad.b,this.pad.l)},_getCenterOffset:function(){return{x:(this.pad.l-this.pad.r)/2,y:(this.pad.t-this.pad.b)/2}},_setMapView:function(a,c){c=this._getCenterOffset();a.centerOffset&&(c.x+=a.centerOffset.x,c.y+=a.centerOffset.y);a.centerOffset=b("leaflet").point(c.x,c.y);a.center&&(a.center=b("leaflet").latLng(a.center.latitude,a.center.longitude));this.map.setView(a)},_findMinZoomWherePinIsAlone:function(a){if(this.visiblePins.length<2)return this.minZoom;var b=Number.MAX_VALUE,c=null,d=a.anchor.getAbsoluteXY();for(var e=0;e<this.visiblePins.length;e++){var f=this.visiblePins[e],g=f.anchor.getAbsoluteXY().distanceTo(d);g<b&&f!==a&&(b=g,c=f)}g=a.getAggregationRadius()+c.getAggregationRadius();f=this.maxZoom;while(b/2>g&&f>this.minZoom)f--,b/=2;while(f<this.maxZoom){e=this._aggregateZoom(this.visiblePins,f);for(var d=0;d<e.length;d++){c=e[d];if(c.members.length==1&&c.members[0]===a)return f}f++}return f},_smartPan:function(a,c,d,e){a=a||this.maxCalloutWidth;c=c||this.maxCalloutHeight;var f=b("MapRects").pad(this._getNoPanBounds(c),l-this.CALLOUT_MARGIN),g=new(b("Vector"))(e.getCenter().x,e.calloutY);if(b("MapRects").containsPoint(f,g)){f=this._getVisibleBounds();c=g.sub(b("MapRects").boundPoint(this._getNoPanBounds(c),g));a=e.w()/2+b("AggregatedMapCallout").ARROW_HEIGHT_PLUS_PADDING+a+this.CALLOUT_MARGIN;g.x>f.getCenter().x?(d.setOrientation(b("AggregatedMapCalloutOrientation").LEFT),c.x||(c.x=g.x-Math.max(g.x,a+f.l))):(d.setOrientation(b("AggregatedMapCalloutOrientation").RIGHT),c.x||(c.x=g.x-Math.min(g.x,f.r-a)));d=null;c.magnitude()>=1&&(d=new(b("Vector"))(this._getW()/2+c.x+this._getCenterOffset().x,this._getH()/2+c.y+this._getCenterOffset().y));return d}return this._anchoredPan(u.Anchor.DEFAULT,b("AggregatedMapCalloutOrientation").RIGHT,this._getInternalCallout(),e)},_leftRightNoPan:function(a,c){c.getCenter().x>this._getVisibleBounds().getCenter().x?a.setOrientation(b("AggregatedMapCalloutOrientation").LEFT):a.setOrientation(b("AggregatedMapCalloutOrientation").RIGHT)},_noPan:function(a,b,c){b.setOrientation(a)},_anchoredPan:function(a,c,d,e){var f=this._getVisibleBounds();d.setOrientation(c);a===u.Anchor.DEFAULT&&(a=new(b("Vector"))(f.getCenter().x-this.maxCalloutWidth/2-e.w()/2,f.getCenter().y-p*this._getH()-o+b("AggregatedMapCallout").ARROW_WIDTH/2));return e.getCenter().sub(a).add(new(b("Vector"))(this._getW()/2,this._getH()/2))},_renderOverlay:function(){if(!this.mapReady)return;this.lastRender=this.topLeft;var a,c=new(b("Rect"))(-this.padding,this._getW()+this.padding,this._getH()+this.padding,-this.padding);for(var d=0;d<this.groups.length;d++){a=this.groups[d];var e=a.getCenter();if(b("MapRects").containsPoint(c,e)){e=a.renderMarker(this.canvas);a.pins.length>1?(e.setOnClick(this._bubbleClick.bind(this,a)),e.setOnMouseover(this._bubbleMouseover.bind(this,a)),e.setOnMouseout(this._bubbleMouseout.bind(this,a))):(e.setOnClick(this._pinClick.bind(this,a.pins[0])),e.setOnMouseover(this._pinMouseover.bind(this,a.pins[0])),e.setOnMouseout(this._pinMouseout.bind(this,a.pins[0])))}else a.dismissMarker()}this._position();while(this.initialPinsToHide.length)b("CSS").hide(this.initialPinsToHide.pop())},_getNoPanBounds:function(a){a=this._getVisibleBounds();return b("MapRects").pad(new(b("Rect"))(a.t+n,a.r,a.b-n,a.l),-this.CALLOUT_MARGIN)},_getCalloutAnchorGroup:function(a){return a&&(a.group||a)},_getPrimaryCalloutAnchor:function(){return this._getInternalCallout().getAnchor()||this._externalCalloutAnchor},_getPrimaryCalloutAnchorGroup:function(){return this._getCalloutAnchorGroup(this._getPrimaryCalloutAnchor())},_zoom:function(a,c,d,e){c=Math.max(b("LegacyMapCoordinate").MIN_ZOOM,Math.min(this.getZoom()+c,b("LegacyMapCoordinate").MAX_ZOOM)),this.map.setView({animate:a,zoom:c,center:d,centerOffset:e})},_getMapView:function(){return{center:this.map.getCenter(),zoom:this.map.getZoom(),width:this.map.getWidth(),height:this.map.getHeight()}},_setZoomButtonVisibility:function(){var a=b("DOM").scry(this.canvas,"label.__1")[0],c=b("DOM").scry(this.canvas,"label.__2")[0];a&&b("CSS").conditionClass(a,"uiButtonDisabled",this.getZoom()>=this.maxZoom);c&&b("CSS").conditionClass(c,"uiButtonDisabled",this.getZoom()<=this.minZoom)},_aggregate:function(){this.logger&&this.logger.startRun("_aggregate");var a,c=this._aggregateZoom(this.visiblePins,this.getZoom()),d=[];for(var e=0;e<c.length;e++){var f=c[e];a=new(b("AggregatedMapGroup"))(f.members,f.rect,f.sprite,this.dynamicMap.mapToPixel.bind(this.dynamicMap));d.push(a);for(var g=0;g<f.members.length;g++)f.members[g].group=a}for(var f=0;f<this.groups.length;f++)a=this.groups[f],a.dismissMarker(),a.deleted=!0;for(var g=0;g<this.callouts.length;g++)this.callouts[g].getAnchor()&&this.callouts[g].getAnchor().getType()==="AggregatedMapGroup"&&this.callouts[g].close();this.groups=d;this._renderOverlay();this.logger&&this.logger.endRun("_aggregate")},_combine:function(a,c){for(var d=0;d<c.members.length;d++)a.members.push(c.members[d]);a.rect=b("MapRects").boundingBox(a.rect,c.rect);a.sprite=a.sprite.combine(c.sprite);a.radius=a.sprite.getAggregationRadius();a.center=a.rect.getCenter();a.single=0;return a},_overlap:function(a,b){var c=a.center.y-b.center.y,d=a.center.x-b.center.x;a.single+b.single==1&&(a.single&&c>i/2?c-=i:b.single&&-c<i/2&&(c+=i));a=a.radius+b.radius;return d*d+c*c<a*a},_aggregateZoom:function(a,c){for(var d=0;d<a.length;d++){a[d].setZoom(c);var e=a[d].center;a[d].rect=new(b("Rect"))(e.y,e.x,e.y,e.x);a[d].single=1}e=[];d=[];for(var f=0;f<a.length;f++){var g=a[f],h={};Object.assign(h,g);h.radius=g.getAggregationRadius();h.members=[g];h.radius?e.push(h):d.push(h)}c<this.maxZoom&&e.length>1&&(e=new(b("MapAggregation"))().aggregate(e,this._combine.bind(this),this._overlap.bind(this)));return e.concat(d)},_position:function(){this.logger&&this.logger.startRun("_position");var a=this._getW()/2;for(var b=0;b<this.groups.length;b++)this.groups[b].updatePosition(a);this.updateCallouts();this.logger&&this.logger.endRun("_position")},_getDims:function(){return new(b("Vector"))(this._getW(),this._getH())},_getH:function(){return this.map.getHeight()},_getW:function(){return this.map.getWidth()},_onMapClick:function(){this._inform(u.Events.mapClick)},_onViewChangeEnd:function(){this._inform(u.Events.viewChangeEnd,this._getMapView(),"state")},_onViewChange:function(){this.mapReady=!0;this._inform(u.Events.viewChange,this._getMapView(),"state");this.topLeft=b("LegacyMapCoordinate").fromLatLong(this.getCenter()).add(this.getZoom(),this._getDims().mul(-.5));if(this.lastZoom!==this.getZoom()){this.lastZoom=this.getZoom();while(this.zoomStack.length&&this.getZoom()<=this.zoomStack[this.zoomStack.length-1].zoom)this.zoomStack.pop();this._setZoomButtonVisibility();this._aggregate()}else!this.lastRender||this.topLeft.calculateDistanceX(this.getZoom(),this.lastRender)>j||this.topLeft.calculateDistanceY(this.getZoom(),this.lastRender)>j?this._renderOverlay():this._position();var a=b("DOM").scry(this.canvas,"span.__0")[0];a&&b("CSS").conditionShow(a,this._showSnapBack())},_showSnapBack:function(){if(this.zoomStack.length)return!0;else if(this.initialView){var a=this.initialView;if(this.getZoom()>a.zoom)return!0;else{var c=this._getMapView(),d=s/b("LegacyMapUtils").scale(1,this.getZoom());return Math.abs(c.center.latitude-a.center.latitude)>d||Math.abs(c.center.longitude-a.center.longitude)>d}}return!1},_onMouseDown:function(a){this.xDown=a.pageX,this.yDown=a.pageY},_onMouseUp:function(a){this.xDown==a.pageX&&this.yDown==a.pageY&&this._onMapClick()},_onZoomStart:function(a){for(var a=0;a<this.groups.length;a++)this.groups[a].dismissMarker()},_onBeforeLeave:function(){for(var a=0;a<this.listeners.length;a++)this.listeners[a].unsubscribe();this.bingMapEvents.forEach(function(a){this.map.off(a.name,a.callback,this)},this)}});Object.assign(u,{Anchor:{DEFAULT:"default_anchor"},Events:{calloutHidden:"calloutHidden",ready:"ready",mapClick:"mapClick",viewChange:"viewChange",viewChangeEnd:"viewChangeEnd",bubbleClick:"bubbleClick",bubbleMouseover:"bubbleMouseover",bubbleMouseout:"bubbleMouseout",pinClick:"pinClick",pinMouseover:"pinMouseover",pinMouseout:"pinMouseout",onSearchSubmit:"onSearchSubmit"},Listeners:{hideCallout:"hideCallout",zoomDelta:"zoomDelta",zoomIn:"zoomIn",zoomOut:"zoomOut",zoomBack:"zoomBack",closeCalloutAndZoomBack:"closeCalloutAndZoomBack",onAddPin:"onAddPin"},inform:function(a,c,d,e){d||(d={},d._instanceid=a),b("Arbiter").inform("AggregatedMap/"+c,d,e)},listenThenInform:function(a,c,d,e){b("Event").listen(c,d,function(){u.inform(a,e)})},subscribe:function(a,c,d){b("Arbiter").subscribe("AggregatedMap/"+c,u._guard(a,d))},subscribeAll:function(a,b){for(var c in u.Events){var d=b["aggregatedMapHandler_"+c];d&&(d=d.bind(b),u.subscribe(a,c,d))}},_guard:function(a,b){return function(b,c,d){if(!d._instanceid)throw new Error("aggregated map didnt pass instanceid");else if(d._instanceid!==a)return;return b(d)}.bind(this,b)}});e.exports=u}),null);
__d("AggregatedMapCircleSprite",["DOM"],(function(a,b,c,d,e,f){function g(a,b,c,d){this._size=a,this._radius=b,d&&(this.chooseAggregationRadius=d,this._aggregationRadius=d(this._size)),this._count=c}function a(){return this._radius}function c(){return this._radius*2}function h(a){switch(a){case g.SIZE_SMALL:return 9;case g.SIZE_MEDIUM:return 11;case g.SIZE_LARGE:return 16}}function d(a){var b;this.chooseAggregationRadius?b=this.chooseAggregationRadius:b=h;a=this.getCount()+a.getCount();if(a>=100)return g.large(a,b);else if(a>=10)return g.medium(a,b);else return g.small(a,b)}Object.assign(g.prototype,{render:function(){var a,c=(a=b("DOM")).create("div",{className:["fbAggregatedMapBubble","fbAggregatedMapBubble"+this._size].join(" ")});a.setContent(c,this._count);var d=a.create("div",{className:["fbAggregatedMapBubbleShell","fbAggregatedMapBubbleShell"+this._size].join(" ")});a.setContent(d,c);this._root=d;return d},combine:d,getCount:function(){return this._count},getHeight:c,getWidth:c,getAnchorX:a,getAnchorY:a,getCalloutX:a,getCalloutY:a,getAggregationRadius:function(){return this._aggregationRadius}});Object.assign(g,{RADIUS_SMALL:15,RADIUS_MEDIUM:20,RADIUS_LARGE:28,SIZE_SMALL:"Small",SIZE_MEDIUM:"Medium",SIZE_LARGE:"Large",small:function(a,b){return new g(g.SIZE_SMALL,g.RADIUS_SMALL,a,b)},medium:function(a,b){return new g(g.SIZE_MEDIUM,g.RADIUS_MEDIUM,a,b)},large:function(a,b){return new g(g.SIZE_LARGE,g.RADIUS_LARGE,a,b)},combine:d});e.exports=g}),null);
__d("AggregatedMapPin",["LegacyMapCoordinate"],(function(a,b,c,d,e,f){function g(a,c,d,e,f){this.anchor=b("LegacyMapCoordinate").fromLatLong(a),this.sprite=c,this.name=d||null,this.group=null,this.xhp=e,this.profileID=f}Object.assign(g.prototype,{getType:function(){return"AggregatedMapPin"},setZoom:function(a){this.center=this.anchor.getMapXY(a)},getLatitude:function(){return this.anchor.getLatitude()},getLongitude:function(){return this.anchor.getLongitude()},getGroup:function(){return this.group},getAggregationRadius:function(){return this.sprite.getAggregationRadius()},setSprite:function(a){this.sprite=a},setCallout:function(a){this._agg_map_callout=a}});Object.assign(g,{create:function(a,b,c,d){return new g(a,b,c,d)}});e.exports=g}),null);
__d("AggregatedMapRedPinSprite",["AggregatedMapCircleSprite","CSS","DOM"],(function(a,b,c,d,e,f){function g(a,b,c,d,e,f,g,h,i){this.size=a,this.image=b,this.width=c,this.height=d,this.calloutY=e,this.aggregationRadius=f,this.text=h,this.count=g,this.css=i}Object.assign(g.prototype,{render:function(){var a=b("DOM").create("div");b("CSS").addClass(a,"fbAggregatedMapPin");b("CSS").addClass(a,"fbAggregatedMapPin"+this.size);this.css&&b("CSS").addClass(a,this.css);var c="/images/places/map/"+this.image;c=b("DOM").create("img",{src:c});b("DOM").appendContent(a,c);c=null;this.text&&(c=b("DOM").create("div"),b("CSS").addClass(c,"fbAggregatedMapPinText"),b("CSS").addClass(c,"fbAggregatedMapPinText"+this.size),b("DOM").setContent(c,this.count),b("DOM").appendContent(a,c));return a},combine:b("AggregatedMapCircleSprite").combine,getCount:function(){return this.count},getHeight:function(){return this.height},getWidth:function(){return this.width},getAnchorX:function(){return this.width/2},getAnchorY:function(){return this.height},getCalloutX:function(){return this.width/2},getCalloutY:function(){return this.calloutY},getAggregationRadius:function(){return this.aggregationRadius}});Object.assign(g,{dot:function(a){a===void 0&&(a=1);return new g("Small","small_dot.png",17,22,8,10,a,!1)},smallBlank:function(a){return new g("Small","small_blank.png",17,22,8,10,a,!0)},mediumBlank:function(a){return new g("Medium","medium_blank.png",25,34,12,14,a,!0)},largeBlank:function(a){return new g("Large","large_blank.png",29,43,14,17,a,!0)}});e.exports=g}),null);
__d("TimelineMapPlace",[],(function(a,b,c,d,e,f){function a(a){this.stories=[],this.creation=!1,this.name=null,a.latitude||(a.latitude=0),a.longitude||(a.longitude=0),Object.assign(this,a),this.region&&(this.region=this.region+":"+this.country),this.visibleStories=this.stories}Object.assign(a.prototype,{setFilters:function(a){var b=[];for(var c=0;c<this.stories.length;c++)(!a||this.stories[c].categories.includes(a))&&b.push(this.stories[c]);this.visibleStories=b},getStories:function(a,b){a===void 0&&(a=!0);a=a?this.visibleStories:this.stories;if(!b)return a;else{var c=[];for(var d=0;d<a.length;d++){var e=a[d];b(e)&&c.push(e)}return c}},count:function(a,b){a=this.getStories(a,b).length;this.creation&&a++;return a}});Object.assign(a,{Filters:{MLE:function(a){return a&&!a.isEnt},ALL:null}});e.exports=a}),null);
__d("TimelineMapStory",[],(function(a,b,c,d,e,f){function a(a){Object.assign(this,a)}e.exports=a}),null);
__d("TimelineMapController",["AggregatedMap","AggregatedMapCalloutOrientation","AggregatedMapPin","AggregatedMapRedPinSprite","Arbiter","AsyncRequest","Bootloader","CSS","DOM","LegacyMapCoordinate","MapRects","PageEvents","Rect","Style","TimelineMapPlace","TimelineMapStory","Vector","$","isEmpty","mod","randomShuffle","shield"],(function(a,b,c,d,e,f){var g,h=198,i=132,j=108;Object.assign(k,{Events:{updateCategories:"updateCategories",mapClick:"mapClick"},Listeners:{addStories:"addStories",updateStory:"updateStory",deleteStory:"deleteStory",hideStory:"hideStory",undoHideStory:"undoHideStory",addPending:"addPending",creationFlow:"creationFlow",cleanupCreationCallout:"cleanupCreationCallout",cancelCreation:"cancelCreation",creationFinished:"creationFinished",showCallout:"showCallout",callout:"callout",resizeCallout:"resizeCallout",hovercard:"hovercard",highlightMapPlace:"highlightMapPlace",registerScrollableCallout:"registerScrollableCallout",zoomToVisible:"zoomToVisible",hideCallout:"hideCallout",zoomIntoOne:"zoomIntoOne",zoomToArea:"zoomToArea"},inform:function(a,c,d){if(!c||!c._instanceid)return;b("Arbiter").inform(a,c,d||"persistent")}});function k(a,b,c,d,e,f,g){this.profileID=null,this.viewasID=null,this.places={},this.visiblePins=null,this.stories={},this.hiddenStories={},this.placesByTime=[],this.category=null,this.pending=null,this.waitingOnConfirmation=!1,this.highlightedPin=null,this.arbiterListeners=[],this.calloutBeingFetched=null,this.initialized=!1,this._lastResizeCalloutAnchor=null,this._lastResizeCalloutStoryHeight=null,this._lastResizeCalloutStory=null,this._scrollableCalloutController=null,this.inCreation=!1,this.lastTypeaheadEvent=null,this.initialPosition=null,this.initialPlace=null,this.initialStory=null,this.hh=0,this.ww=0,this.smartPan=null,this.requestID=0,this.asyncRequests={},this.intervals=[],this.groups=[],this.pagerIndex=null,this.categoryCountUnique={},a&&this._init(a,b,c,d,e,f,g)}Object.assign(k.prototype,{HOVER_FETCH_DELAY:100,HOVER_DISMISS_DELAY:300,MAP_BOTTOM_PADDING:40,MIN_MAP_HEIGHT:532,MIN_CALLOUT_STORY_HEIGHT:200,MAX_CALLOUT_HEIGHT:600,RESIZE_CHECK_INTERVAL:50,HOVERCARD_WIDTH:279,HOVERCARD_HEIGHT:251,HOVERCARD_CLOSED:void 0,HOVERCARD_WAITING_TO_FETCH:1,HOVERCARD_BEING_FETCHED:2,HOVERCARD_OPEN:3,HOVERCARD_WAITING_TO_DISMISS:4,TIMELINE_MAP_HOVERCARD_PLACE:"Place",TIMELINE_MAP_HOVERCARD_CITY:"City",TIMELINE_MAP_HOVERCARD_REGION:"Region",TIMELINE_MAP_HOVERCARD_COUNTRY:"Country",HOVERCARD_CITY_REGION_HEURISTIC:3,setCategory:function(a){this.logger&&this.logger.startRun("set-category"),this.map.hideCallout(),this.category=a,this._filter()},setCategoryCountUnique:function(a){this.categoryCountUnique=a},getCategories:function(){var a={},b,c;for(var d in this.places){var e=this.places[d],f={};for(var g=0;g<e.stories.length;g++){c=e.stories[g];if(c.categories)for(var h=0;h<c.categories.length;h++)b=c.categories[h],a[b]||(a[b]={count:0,name:b}),f[b]||(f[b]=1),a[b].count++}}return a},zoomToVisible:function(){this.map.zoomTo(this.visiblePins)},cleanupCreationCallout:function(a){this.map.hideCallout(a),this._cleanUpHighlightedPin()},cancelCreation:function(a){if(!this.inCreation)return;this.inCreation=!1;this.cleanupCreationCallout()},creationFinished:function(a,b){a=b.place;var c=b.story;b=b.showCallout;this.inCreation=!1;this.waitingOnConfirmation=!1;this.cleanupCreationCallout();this.addStories(null,{stories:[c],places:[a]});b&&this.showCallout(null,{place_id:a.id,story_id:c.id})},page:function(a){var c=this.map.getGroups();if(!c)return;var d=[],e=!0,f=0;for(var g=0;g<c.length;g++){var h=c[g];if(h.hasMarker()){var i=h.getCenter(),j=new(b("Rect"))(0,this.ww,this.hh,0);b("MapRects").containsPoint(j,i)&&(d.push(h),h===this.groups[f]?f++:e&&(e=!1))}}e=e&&f===this.groups.length;!e?(this.groups=d,this.sortedGroups=d.concat([]).sort(function(a,b){return a.getCenter().x-b.getCenter().x}),a>0?this.pagerIndex=0:this.pagerIndex=-1):this.pagerIndex+=a>0?1:-1;this.pagerIndex=b("mod")(this.pagerIndex,this.sortedGroups.length);j=this.sortedGroups[this.pagerIndex];j.pins.length>1?(this._openCallout(j,this.map.throbber(325),this.map.leftRightNoPanningStrategy()),j.hoverPermanent=!0,j.hoverState=this.HOVERCARD_WAITING_TO_FETCH,this._fetchHovercard(j)):this.aggregatedMapHandler_pinClick(null,j.pins[0])},hovercard:function(a,c){a=this._getAsyncContext(c.requestID);if(a.deleted||a.hoverState!==this.HOVERCARD_BEING_FETCHED)return;a.hoverState=this.HOVERCARD_OPEN;var d=b("DOM").create("div");d.onmouseover=function(){if(!this.map||!this.map.getCallout().getAnchor())return null;this.aggregatedMapHandler_bubbleMouseover(null,this.map.getCallout().getAnchor())}.bind(this);d.onmouseout=function(){if(!this.map||!this.map.getCallout().getAnchor())return null;this.aggregatedMapHandler_bubbleMouseout(null,this.map.getCallout().getAnchor())}.bind(this);b("CSS").setClass(d,"fbTimelineMapHovercard");b("DOM").setContent(d,c.content);a===this.map.getCallout().getAnchor()?this.map.getCallout().setContent(d):this._openCallout(a,d,this.map.leftRightNoPanningStrategy());this.map.getCallout().recalculateArrowYOffset(!0);this.logger&&this.logger.endRun("load-hovercard")},callout:function(a,b){a=this._getAsyncContext(b.requestID);if(this.map.getCallout().getAnchor()!==a)return;this._openCallout(a,b.content);this.logger&&this.logger.endRun("load-callout")},addPending:function(a,b){a=b.count;this.pending=this.pending||0;this.pending+=a;this._checkReady()},hideCallout:function(a,c){c=c||{},c._instanceid=this.instanceID,b("Arbiter").inform("AggregatedMap/hideCallout",c)},addStories:function(a,c){a=c.stories;var d=c.places;c.count&&(this.pending=(this.pending||0)-c.count);var e,f,g;for(g=0;g<d.length;g++)f=new(b("TimelineMapPlace"))(d[g]),this.places[f.id]||(this.places[f.id]=f,this.placesByTime.push(f)),f.mostRecentTimestamp=0;for(g=0;g<a.length;g++)d=new(b("TimelineMapStory"))(a[g]),this.stories[d.id]=d,e=d.placeID,f=this.places[e],f.stories.push(d),f.mostRecentTimestamp=Math.max(f.mostRecentTimestamp,d.timestamp);c.count===void 0?this._refresh():this._checkReady()},updateStory:function(a,b){a=b.place;b=b.story;var c=this.stories[b.id];if(c.placeID!=a.id){var d={};d[c.id]=!0;this._removeStories(c.placeID,d);this.addStories(null,{stories:[b],places:[a]})}this._showCallout(this.places[a.id].pin,a.id,b.id)},deleteStory:function(a,b){a=this.map.getCallout().getAnchor();b=this.stories[b];if(!b)return;var c={};c[b.id]=!0;this.map.hideCallout();b=this._removeStories(b.placeID,c);b.stories_removed&&this._refresh();b.place_removed||this._showCallout(a,a.place.id)},hideStory:function(a,c){a=this.map.getCallout().getAnchor();var d=this.stories[c.story_id];if(!a)return;if(a.getType()!=="AggregatedMapPin")return;if(!d||d.placeID!=a.place.id)return;a=b("$")(c.story_domid);b("CSS").hide(a);c=b("DOM").insertAfter(a,c.undo_html)[0];this.hiddenStories[d.id]={story_domid:a.id,undo_domid:c.id}},undoHideStory:function(a,c){a=this.stories[c];c=this.hiddenStories[a.id];b("DOM").remove(c.undo_domid);b("CSS").show(c.story_domid);delete this.hiddenStories[a.id]},showCallout:function(a,b){a=this.places[b.place_id].pin;this._showCallout(a,b.place_id,b.story_id)},zoomIntoOne:function(a,b){a=this.places[b.place_id];this._zoomToPlace(a)},zoomToArea:function(a,b){a=b.type;b=b.key;var c=[];for(var d in this.places){var e=this.places[d],f=e.pin;(f&&e.city===b&&a===this.TIMELINE_MAP_HOVERCARD_CITY||e.region===b&&a===this.TIMELINE_MAP_HOVERCARD_REGION||e.country===b&&a===this.TIMELINE_MAP_HOVERCARD_COUNTRY)&&c.push(f)}this.map.zoomInto(c)},creationFlow:function(a,b){a=b.place;var c={latitude:a.latitude,longitude:a.longitude};this.waitingOnConfirmation=!1;this._highlightPlace(a.id,c);this._openCallout(this.highlightedPin,b.content,this.smartPan);this.inCreation=!0},highlightMapPlace:function(a,b){if(b.dismiss&&this.waitingOnConfirmation)return;if(b.showThrobber){this._openCallout(this.highlightedPin,this.map.throbber(),this.smartPan);return}this.map.hideCallout();b.dismiss?this._cleanUpHighlightedPin():b.selected?this.waitingOnConfirmation=!0:b.center&&this._highlightPlace(b.placeID,b.center);this.map.setView(b)},registerScrollableCallout:function(a,b){this._scrollableCalloutController=b},_init:function(a,c,d,e,f,g,h){this.profileID=a,this.viewasID=c.viewas,this.mapContainer=d,this.canvas=b("DOM").find(this.mapContainer,".fbAggregatedMapContainer"),this.logger=f,this.instanceID=e,this._dynamicSize=c.dynamicSize,c.center&&(this.initialPosition={latitude:c.center.lat,longitude:c.center["long"]}),this.initialPlace=c.highlightedPlace,this.initialStory=c.highlightedStory,this.enableHovercards=c.enableHovercards,this.calloutDiv=g&&b("$")(g),this.maxCalloutHeight=this.MAX_CALLOUT_HEIGHT,c.maxCalloutHeight&&c.maxCalloutHeight<this.MAX_CALLOUT_HEIGHT&&(this.maxCalloutHeight=c.maxCalloutHeight),h&&(h.subscribe("next",this.page.bind(this,1)),h.subscribe("previous",this.page.bind(this,-1))),this.border=b("$")("fbTimelineMapBorder"),this._subscribe(b("PageEvents").AJAXPIPE_ONUNLOAD,this._onBeforeLeave.bind(this)),this._subscribe("AggregatedMap/ready",this._onInit.bind(this)),this._subscribe("AggregatedMap/calloutHidden",this.cancelCreation.bind(this)),this._subscribe("AggregatedMap/calloutHidden",b("shield")(b("Arbiter").inform,null,"reflow")),this._subscribe("TimelineMapStickyHeaderComposer/typeaheadFocus",this._handleTypeahead.bind(this,"focus")),this._subscribe("TimelineMapStickyHeaderComposer/typeaheadBlur",this._handleTypeahead.bind(this,"blur")),this._subscribe("TimelineMapStickyHeaderComposer/typeaheadSelect",this._handleTypeahead.bind(this,"select"))},_onInit:function(a,c){this.map=c;this._dynamicSize?(this._resizeMap(),this.intervals=[setInterval(this._resizeMap.bind(this),this.RESIZE_CHECK_INTERVAL),setInterval(this.resizeCallout.bind(this),this.RESIZE_CHECK_INTERVAL)]):(this.hh=this.map.getHeight(),this.ww=this.map.getWidth(),this.intervals=setInterval(this.resizeCallout.bind(this),this.RESIZE_CHECK_INTERVAL));this.initialized=!0;for(var d in k.Listeners)this._subscribe("TimelineMap/"+d,this[d].bind(this));for(var e in b("AggregatedMap").Events){a=this["aggregatedMapHandler_"+e];a&&(a=a.bind(this),this._subscribe("AggregatedMap/"+e,a))}this.smartPan=this.map.smartPanningStrategy()},_getAsyncContext:function(a){var b=this.asyncRequests[a];delete this.asyncRequests[a];return b},_storeAsyncContext:function(a){var b=this.requestID++;this.asyncRequests[b]=a;return b},_inform:function(a,b,c){b=b||{},b._instanceid=this.instanceID,k.inform("TimelineMap/"+a,b,c)},_cleanUpHighlightedPin:function(){this.highlightedPin&&(this.highlightedPin.isPreview?this.map.removePin(this.highlightedPin):(this.highlightedPin.setSprite(this._getPlaceSprite(this.highlightedPin.place)),this.map.redraw()),this.highlightedPin=null,b("CSS").removeClass(this.canvas,"fbTimelineMapDimPinMode"))},_handleTypeahead:function(a){this.lastTypeaheadEvent=a},_checkReady:function(){if(this.pending!==0)return;this._refresh();if(this.logger){window._cstart&&this.logger.set("flushTTI",Date.now()-window._cstart);for(var c in this.places){var d=this.places[c];this.logger.bump("places");this.logger.bump("stories",d.count())}this.logger.set("profileID",this.profileID)}a.CavalryLogger&&b("Bootloader").loadModules(["CavalryLoggerImpl"],function(){a.CavalryLogger.getInstance().measurePageLoad(!0)},"TimelineMapController");d=this.initialPlace;if(d){this.map.zoomTo(this.visiblePins,!1);this.map.setInitialView();d=this.places[d].pin;if(d){var e=new(b("Vector"))(h,i);e=e.sub(new(b("Vector"))(this.ww/2,this.hh/2));this.map.zoomIntoOne(d,e);e=b("DOM").find(this.calloutDiv,".fbTimelineMapCallout");b("DOM").remove(this.calloutDiv);this._openCallout(d,e);this.map.getCallout().setArrowYOffset(j);this.map.updateCallouts()}}else this.initialPosition?this.map.setView({center:this.initialPosition}):(this.map.zoomTo(this.visiblePins,!1),this.map.setInitialView());b("CSS").addClass(this.border,"fbTimelineMapContainerLoaded")},_refresh:function(){this.placesByTime=this.placesByTime.sort(function(a,b){return a.mostRecentTimestamp-b.mostRecentTimestamp}),this._filter(),this._inform(k.Events.updateCategories,null,"state")},_resizeMap:function(){var a=b("Vector").getViewportDimensions().y,c=b("Vector").getElementPosition(this.border).y,d=b("Vector").getElementDimensions(this.border).y;c=a-(c+d);d=this.hh+c-this.MAP_BOTTOM_PADDING;d=Math.max(this.MIN_MAP_HEIGHT,Math.min(d,a));Math.abs(this.hh-d)>1&&(b("Style").set(this.mapContainer,"height",d+"px"),this.map.invalidateSize(),this.hh=d,this.ww=this.map.getWidth(),this._resizeMap())},resizeCallout:function(){try{var a=this.map.getCallout().getContent()}catch(a){return}var c=b("DOM").scry(a,".fbTimelineMapScrollableStory");for(var d=c.length-1;d>=0;d--)if(!b("CSS").hasClass(c[d],"hidden_elem")){var e=c[d],f=b("DOM").find(e,".fbTimelineMapCalloutStory");break}if(!(a&&f&&e))return;c=b("Vector").getElementDimensions(f).y;if(this.map.getCallout().getAnchor()===this._lastResizeCalloutAnchor&&c===this._lastResizeCalloutStoryHeight&&f===this._lastResizeCalloutStory)return;d=b("DOM").find(a,".fbTimelineMapCalloutHeader");a=b("Vector").getElementDimensions(d).y;d=b("Vector").getElementPosition(e).y;var g=b("Vector").getElementPosition(this.mapContainer).y,h=this.hh-this.map.CALLOUT_MARGIN;g=Math.max(this.MIN_CALLOUT_STORY_HEIGHT,Math.min(g+h-d,h-a));d=Math.min(c,g,this.maxCalloutHeight);b("Style").set(e,"height",d+"px");this._lastResizeCalloutAnchor=this.map.getCallout().getAnchor();this._lastResizeCalloutStoryHeight=c;this._lastResizeCalloutStory=f;this._scrollableCalloutController&&this._scrollableCalloutController.adjustGripper();this.map.getCallout()._updateDimensions();this.map.getCallout().recalculateArrowYOffset()},_filter:function(){var a=[];for(var c in this.places){var d=this.places[c];d.setFilters(this.category);if(d.count()>0){var e=this._getPlaceSprite(d);e=b("AggregatedMapPin").create(d,e,d.name);d.pin=e;e.place=d;a.push(e)}}this.visiblePins=a;this.highlightedPin&&this.visiblePins.push(this.highlightedPin);this.map.setPins(a)},_getPlaceSprite:function(a){a=a.getStories();var c=a.length,d;c>=100?d=b("AggregatedMapRedPinSprite").largeBlank(c):c>10?d=b("AggregatedMapRedPinSprite").mediumBlank(c):c>1?d=b("AggregatedMapRedPinSprite").smallBlank(c):a[0]&&a[0].pin?(d=b("AggregatedMapRedPinSprite").mediumBlank(1),d.text=!1,d.image=a[0].pin+".png"):d=b("AggregatedMapRedPinSprite").dot();return d},_getHighlightedSprite:function(){var a=b("AggregatedMapRedPinSprite").dot();a.aggregationRadius=0;a.css="fbTimelineMapHighlighted";return a},_highlightPlace:function(a,c){this._cleanUpHighlightedPin();a&&this.places[a]!==void 0?(a=this.places[a].pin,a.setSprite(this._getHighlightedSprite()),this.map.redraw()):(a=new(b("AggregatedMapPin"))(b("LegacyMapCoordinate").fromLatLong(c),this._getHighlightedSprite()),a.isPreview=!0,this.map.addPin(a));this.highlightedPin=a;b("CSS").addClass(this.canvas,"fbTimelineMapDimPinMode");return a},_showCallout:function(a,c,d){if(this.map.getCallout()&&this.map.getCallout().getOrientation()){var e=this.map.getCallout().getOrientation()===b("AggregatedMapCalloutOrientation").LEFT;e=new(b("Vector"))(e?200:-200,-100);this.map.zoomIntoOne(a,e)}this._openCallout(a,this.map.throbber(),this.smartPan);this._fetchCallout(a,c,d)},_fetchCallout:function(a,c,d){this.logger&&this.logger.startRun("load-callout");a=this._storeAsyncContext(a);c=this.places[c];var e=[],f={},g=c.getStories();for(var h=0;h<g.length;++h){var i=g[h];!i.isEnt?e.push(i.unitParams):(f[i.storyType]=f[i.storyType]||[],f[i.storyType].push(i.id))}i={profile_id:this.profileID,targetid:c.id,storyid:d,unitparams:e,storiesbytype:f,request_id:a,viewas:null};this.viewasID&&this.viewasID!="0"&&(i.viewas=this.viewasID);new(b("AsyncRequest"))().setURI("/ajax/timeline/map/callout.php").setMethod("POST").setData(i).send()},_openCallout:function(a,b,c){var d=this.map.getCallout().getAnchor();d&&this._dismissHovercard(d);this.map.openCallout(a,b,c);this.resizeCallout()},_zoomToPlace:function(a){var c=b("AggregatedMapCalloutOrientation").LEFT,d=b("AggregatedMapCalloutOrientation").RIGHT,e=this.map.getCallout().getOrientation()===c,f=new(b("Vector"))(e?200:-200,-100);this.map.zoomIntoOne(a.pin,f);this._openCallout(a.pin,this.map.throbber(),this.map.noPanningStrategy(e?c:d));this._fetchCallout(a.pin,a.id)},_fetchHovercard:function(a){this.logger&&this.logger.startRun("load-hovercard");if(a.deleted||a.hoverState!==this.HOVERCARD_WAITING_TO_FETCH)return;if(a.pins.length<2)throw new Error("bubble has < 2 pins!");delete a.timeoutToken;a.hoverState=this.HOVERCARD_BEING_FETCHED;var c=[],d=[],e={},f={},g={},h={},i={},j={};a.pins.forEach(function(a){a=a.place;var b=a.getStories();j[a.id]=!0;for(var k=0;k<b.length;k++)c.push(b[k]);d.push(a);a.city&&(e[a.city]=e[a.city]||0,e[a.city]++,a.region&&(i[a.region]=a.city),a.country&&(h[a.country]=a.city));a.region&&(f[a.region]=f[a.region]||0,f[a.region]++);a.country&&(g[a.country]=g[a.country]||0,g[a.country]++)});var k=d.length;a=this._storeAsyncContext(a);var l=this._getStoriesByType(c).TimelineMapStoryPhoto||[],m=l.length;l=b("randomShuffle")(l).slice(0,4);var n={},o=d.length<=3,p=d.sort(function(a,b){return b.getStories().length-a.getStories().length}).slice(0,3).map(function(a){var b=0,c={},d=a.getStories();for(var e=0;e<d.length;e++){var f=d[e];f=f.visitID;f===0?b++:f in c||(c[f]=!0,b++)}n[a.id]=b;return a.id}),q=!1,r=!1,s=!1;for(var t in this.places){var u=this.places[t];if(!j[u.id]&&(s=s||g[u.country])&&(r=r||f[u.region])&&(q=q||e[u.city]))break}u=null;var v=null,w=null,x=null,y=function(a,b,c){return a[c]-a[b]};e=Object.keys(e).sort(y.bind(null,e));f=Object.keys(f).sort(y.bind(null,f));g=Object.keys(g).sort(y.bind(null,g));y={};y[this.TIMELINE_MAP_HOVERCARD_COUNTRY]=g.map(function(a){return h[a]});y[this.TIMELINE_MAP_HOVERCARD_REGION]=f.map(function(a){return i[a]});y[this.TIMELINE_MAP_HOVERCARD_CITY]=e;y[this.TIMELINE_MAP_HOVERCARD_PLACE]=d.map(function(a){return a.id});g.length>0&&(s||(u=this.TIMELINE_MAP_HOVERCARD_COUNTRY,g.length>1?w=this.TIMELINE_MAP_HOVERCARD_COUNTRY:f.length>1?w=this.TIMELINE_MAP_HOVERCARD_REGION:w=this.TIMELINE_MAP_HOVERCARD_CITY));if(f.length>0&&!u){s=this.HOVERCARD_CITY_REGION_HEURISTIC;(!r||f.length>1&&e.length>f.length*s)&&(u=this.TIMELINE_MAP_HOVERCARD_REGION,f.length>1?w=this.TIMELINE_MAP_HOVERCARD_REGION:w=this.TIMELINE_MAP_HOVERCARD_CITY)}e.length>0&&!u&&((!q||e.length>1)&&(u=this.TIMELINE_MAP_HOVERCARD_CITY,e.length>1?w=this.TIMELINE_MAP_HOVERCARD_CITY:x=d.length));u||(u=this.TIMELINE_MAP_HOVERCARD_PLACE,x=-1);r=y[u];w&&(v=y[w]);s={profile_id:this.profileID,request_id:a,target_count:k,photo_count:m,photo_ids:l,place_counts:n,target_ids:p,all_places:o,ids:r,title_type:u,subtitle_count:x,links:v,link_type:w,viewas:null};this.viewasID&&this.viewasID!="0"&&(s.viewas=this.viewasID);new(b("AsyncRequest"))().setURI("/ajax/timeline/map/hovercard.php").setMethod("POST").setData(s).send()},_dismissHovercard:function(a){delete a.timeoutToken,delete a.hoverState,delete a.hoverPermanent,this.map.getCallout().getAnchor()===a&&this.map.hideCallout()},_getStoriesByType:function(a){var b={};a.forEach(function(a){b[a.storyType]=b[a.storyType]||[],b[a.storyType].push(a.isEnt?a.id:a.unitParams)});return b},_removeStories:function(a,b){var c=0,d=!1,e=this.places[a],f=[],g;for(g=0;g<e.stories.length;++g){var h=e.stories[g];b[h.id]?(delete this.stories[h.id],++c):f.push(h)}f.length===0?(delete this.places[a],d=!0):e.stories=f;return{place_removed:d,stories_removed:c}},_removeHiddenStories:function(){var a=this.map.getCallout().getAnchor();if(!a)return;if(a.getType()!=="AggregatedMapPin")return;if((g||(g=b("isEmpty")))(this.hiddenStories))return;a=a.place.id;a=this._removeStories(a,this.hiddenStories);a.stories_removed!==0&&(this._refresh(),this.hiddenStories={})},_guard:function(a){return function(b,c){(!c||!c._instanceid||c._instanceid===this.instanceID)&&a(b,c)}.bind(this)},_subscribe:function(a,c){this.arbiterListeners.push(b("Arbiter").subscribe(a,this._guard(c)))},aggregatedMapHandler_mapClick:function(){this._removeHiddenStories(),this.map.hideCallout(),this._inform(k.Events.mapClick)},aggregatedMapHandler_pinClick:function(a,b){this.logger&&this.logger.bumpTap("pin-click"),this._removeHiddenStories(),this.map.getCallout().getAnchor()===b?this.map.hideCallout():this._showCallout(b,b.place.id)},aggregatedMapHandler_bubbleClick:function(a,b){this.logger&&this.logger.bumpTap("bubble-click"),this.map.hideCallout(),this.map.zoomInto(b.pins)},aggregatedMapHandler_bubbleMouseover:function(a,b){if(!this.enableHovercards||b.hoverPermanent)return;!b.hoverState||b.hoverState===this.HOVERCARD_CLOSED?(b.hoverState=this.HOVERCARD_WAITING_TO_FETCH,b.timeoutToken=setTimeout(this._fetchHovercard.bind(this,b),this.HOVER_FETCH_DELAY)):b.hoverState===this.HOVERCARD_WAITING_TO_DISMISS&&(clearTimeout(b.timeoutToken),delete b.timeoutToken,b.hoverState=this.HOVERCARD_OPEN)},aggregatedMapHandler_bubbleMouseout:function(a,b){if(b.hoverPermanent)return;b.hoverState===this.HOVERCARD_WAITING_TO_FETCH||b.hoverState===this.HOVERCARD_BEING_FETCHED?(clearTimeout(b.timeoutToken),delete b.timeoutToken,delete b.hoverState):b.hoverState===this.HOVERCARD_OPEN&&(b.timeoutToken=setTimeout(this._dismissHovercard.bind(this,b),this.HOVER_DISMISS_DELAY),b.hoverState=this.HOVERCARD_WAITING_TO_DISMISS)},_onBeforeLeave:function(){for(var a=0;a<this.arbiterListeners.length;a++)this.arbiterListeners[a].unsubscribe();for(var a=0;a<this.intervals.length;a++)clearInterval(this.intervals[a]);this.logger=null;this.map=null;this.places=null}});e.exports=k}),null);
__d("TriggerablePageletLoader",["CSS","Event","OnVisible","Run","UIPagelet"],(function(a,b,c,d,e,f){var g=[];function h(a){var b=g[a];if(!b)return;b=b._trigger;b&&b.remove();delete g[a]}a=function(){"use strict";function a(a,c){var d=this;this._disabledTriggerKeys=[];this._pageletConfig=a;this._loaded=!1;this._loading=!1;this._triggerKeys=[];c&&c.forEach(function(a){return d.addTrigger(a)});b("Run").onLeave(this.destroy.bind(this))}var c=a.prototype;c.addTrigger=function(b){var c=b.type;if(c===a.TRIGGER_NOW){this._onTrigger(b);return}c=babelHelpers["extends"]({},b);c._trigger=this._createTrigger(b);g.push(c);this._triggerKeys.push(g.length-1)};c.removeTriggers=function(a){this._triggerKeys.forEach(function(b){var c=g[b];c&&(!a||c.type===a)&&h(b)})};c.destroy=function(){this.removeTriggers(),this._pageletRequest&&(this._pageletRequest.cancel(),this._pageletRequest=null,this._loading=!1,this._loaded=!1)};c.disableTriggers=function(){var a=this;this._triggerKeys.forEach(function(b){var c=g[b];c&&(c._trigger&&c._trigger.remove(),a._disabledTriggerKeys.push(b))})};c.enableTriggers=function(){var a=this;if(this._loaded||this._loading)return;this._disabledTriggerKeys.forEach(function(b){b=g[b];b&&(b._trigger=a._createTrigger(b))});this._disabledTriggerKeys.length=0};c._createTrigger=function(c){this._loaded||this._loading;var d=this._onTrigger.bind(this,c);switch(c.type){case a.TRIGGER_CLICK:return b("Event").listen(c.node,"click",function(a){if(a.isDefaultRequested())return;a.prevent();d()});case a.TRIGGER_ONVISIBLE:return new(b("OnVisible"))(c.node,d,c.onVisibleStrict,c.onVisibleBuffer);case a.TRIGGER_NOW:default:throw new Error("Unexpected trigger type: "+c.type)}};c.load=function(a){if(this._loaded||this._loading)return;this._loading=!0;this._loaded=!1;b("CSS").addClass(this._pageletConfig.node,"async_saving");a&&a.node&&b("CSS").addClass(a.node,"async_saving");var c=this._pageletConfig.options||{};c.displayCallback=this._onLoad.bind(this,a);c.crossPage===void 0&&(c.crossPage=!0);this._pageletRequest=b("UIPagelet").loadFromEndpoint(this._pageletConfig.controller,this._pageletConfig.node,this._pageletConfig.data,c)};c._onLoad=function(a,c){this._loaded=!0,this._pageletRequest=null,b("CSS").removeClass(this._pageletConfig.node,"async_saving"),a&&a.node&&b("CSS").removeClass(a.node,"async_saving"),this._pageletConfig.displayCallback?this._pageletConfig.displayCallback(c):c()};c._onTrigger=function(a){a.callback&&a.callback(a),!this._loaded&&!this._loading&&this.load(a)};a.removeTrigger=function(a){for(var b=0;b<g.length;b++){var c=g[b];if(c&&c.node===a){h(b);return}}};return a}();a.TRIGGER_CLICK="click";a.TRIGGER_ONVISIBLE="onvisible";a.TRIGGER_NOW="now";e.exports=a}),null);
__d("MedleyPageletRequestData",["invariant","regeneratorRuntime","Promise","CallbackDependencyManager"],(function(a,b,c,d,e,f,g){var h=null,i=new(b("CallbackDependencyManager"))();a={reset:function(){h=null,i=new(b("CallbackDependencyManager"))()},get:function(){return b("regeneratorRuntime").async(function(a){while(1)switch(a.prev=a.next){case 0:return a.abrupt("return",new(b("Promise"))(function(a){i.registerCallback(function(){h||g(0,5210),a(h)},["data"])}));case 1:case"end":return a.stop()}},null,this)},set:function(a){h=a,i.satisfyPersistentDependency("data")}};e.exports=a}),null);
__d("TimelineAppSectionCuration",["cx","Animation","AppSectionCurationState","Arbiter","AsyncSignal","CSS","Ease","Event","OnVisible","Parent","ProfileOverviewSection","Style","TidyArbiterMixin","getOrCreateDOMID","queryThenMutateDOM","tidyEvent"],(function(a,b,c,d,e,f,g){var h=0,i={},j={};function k(a,c,d){b("Style").set(a,"overflow","visible");var e=a.offsetHeight,f=c===b("AppSectionCurationState").hide?0:a.firstChild.offsetHeight;b("Style").set(a,"overflow","hidden");b("queryThenMutateDOM")(null,function(){b("Style").set(a,"overflow","hidden");b("Style").set(a,"height",e+"px");f&&b("CSS").addClass(a.parentNode,"_52bu");window.setTimeout(b("OnVisible").checkBuffer,0);var c=b("getOrCreateDOMID")(a);j[c]&&j[c].stop();j[c]=new(b("Animation"))(a).to("height",f).ondone(function(){delete j[c],f&&(b("Style").set(a,"overflow",""),b("Style").set(a.parentNode,"overflow","")),f||b("CSS").removeClass(a.parentNode,"_52bu"),b("Arbiter").inform("reflow")}).duration(Math.abs(f-e)*1.5).ease(b("Ease").sineOut).go()})}function l(a,c){a&&(b("CSS").show(c),b("CSS").hide(a))}function m(a,c){a&&(b("CSS").show(a),b("CSS").hide(c))}function n(a,c){b("ProfileOverviewSection").callWithSection(a,function(a){new(b("AsyncSignal"))("/ajax/timeline/collections/app_recs/",{collection_token:a.getActiveCollection().getToken(),event_type:c}).send()})}var o=babelHelpers["extends"]({addSection:function(a,c,d){i[a]={appClickLogged:!1,buttons:c,content:d,id:a,state:b("AppSectionCurationState").hide,previousState:b("AppSectionCurationState").hide,currentCollectionToken:void 0,onVisible:null};b("Style").set(d,"height","0px");b("Style").set(d,"overflow","hidden");b("CSS").show(d);for(var e in c){var f;b("tidyEvent")([(f=b("Event")).listen(c[e].hide_button,"click",o.informState.bind(null,b("AppSectionCurationState").hide,a)),f.listen(c[e].hide_button,"click",o.informToggleDrawer.bind(null,"hide",a)),f.listen(c[e].show_button,"click",o.informState.bind(null,e,a)),f.listen(c[e].show_button,"click",o.informToggleDrawer.bind(null,"show",a))])}o.register(a,function(e,f,g,j){i[a].onVisible&&i[a].onVisible.remove();i[a].onVisible=new(b("OnVisible"))(d,k.bind(null,d,e,j),!0,h);for(var n in c)m(c[n].show_button,c[n].hide_button);c[e]&&l(c[e].show_button,c[e].hide_button)})},informState:function(a,c,d,e){e===void 0&&(e=!0);if(i[c]){var f=i[c].state;!e&&a==b("AppSectionCurationState").hide&&(a=f);!e&&d==i[c].currentCollectionToken&&(a=i[c].previousState);d&&(i[c].currentCollectionToken=d);i[c].state!==a&&(a===b("AppSectionCurationState").showApps&&!i[c].appClickLogged&&(i[c].appClickLogged=!0,n(c,"add_apps_click")),i[c].previousState=f,i[c].state=a,o.inform(a,{obj:i[c],oldState:f}))}},informToggleDrawer:function(a,b){o.inform("toggle_drawer",{button_clicked:a,section:i[b]})},refreshState:function(a,b){o.inform(a,{obj:i[b],oldState:a})},linkContent:function(a,c,d){var e=i[a].buttons[b("AppSectionCurationState").showApps].show_button;b("CSS").show(b("Parent").byClass(e,"hidden_elem"));new(b("OnVisible"))(e,function(){Math.floor(Math.random()*100)===0&&n(a,"add_apps_imp")},!0,h);o.register(a,function(e,f,g,h){e==b("AppSectionCurationState").showItems?(h==b("AppSectionCurationState").showApps&&b("Style").set(i[a].content.parentNode,"overflow","hidden"),b("CSS").show(c),b("CSS").hide(d)):e==b("AppSectionCurationState").showApps&&(b("CSS").hide(c),b("CSS").show(d))})},register:function(a,c){var d=o.subscribe([b("AppSectionCurationState").hide,b("AppSectionCurationState").showItems,b("AppSectionCurationState").showApps],function(b,e){e.obj.id===a&&c(b,e.obj,d,e.oldState)})},getSectionState:function(a){if(i[a])return i[a].state}},b("TidyArbiterMixin"));e.exports=o}),null);
__d("TimelineDynamicSection",["cx","DOM","ProfileOverviewSection","TimelineDynamicSectionMarkup","ge"],(function(a,b,c,d,e,f,g){a=function(a){"use strict";babelHelpers.inheritsLoose(c,a);function c(b,c,d){b=a.call(this,b,b,d)||this;b._controller=c;b._node=null;return b}var d=c.prototype;d._createNode=function(){return b("DOM").create("div",{className:"_30f",id:this.nodeID},[b("TimelineDynamicSectionMarkup").throbber.cloneNode(!0)])};d.getNode=function(){this._node||(this._node=b("ge")(this.nodeID)||this._createNode());return this._node};return c}(b("ProfileOverviewSection"));e.exports=a}),null);
__d("TimelineAppCollection",["csx","cx","regeneratorRuntime","Arbiter","CSS","DOM","DOMQuery","Event","MedleyPageletRequestData","NumberFormatConfig","PageTransitions","Parent","ProfileOverviewSection","ProfileTabUtils","TidyArbiterMixin","TimelineAppSectionCuration","TimelineDynamicSection","TimelineDynamicSectionMarkup","TriggerablePageletLoader","ads-lib-formatters","classWithMixins","ge","mixin","nullthrows","promiseDone"],(function(a,b,c,d,e,f,g,h){var i=500,j=8;function k(a){a=b("ge")(b("ProfileTabUtils").getIDForCollectionToken(a));return!a?null:b("DOM").scry(a,"._620")[0]}function l(a,c){if(c)if(c.isDefaultRequested&&c.isDefaultRequested())return;else c.prevent&&c.prevent();c=b("nullthrows")(a._parentSection);var d=b("nullthrows")(c._parentSection);b("ProfileOverviewSection").setActiveSectionID(c.id);c.setActiveCollection(a);c.isActiveAppSection()&&(b("CSS").matchesSelector(d.getNode(),"._c4f")||(b("CSS").addClass(d.getNode(),"_c4f"),d.freezeChildren()),a._isFullyLoaded&&d.addSectionTeasers());if(!d.isOverviewProfileTab()&&c.isActiveAppSection()){b("Arbiter").inform("save_facebar_query",!0);var e=a.href;b("PageTransitions").rewriteCurrentURI(b("PageTransitions").getCurrentURI().getUnqualifiedURI(),e)}b("Arbiter").inform("Medley/tab-change",{section:a,appSection:c,appMedley:d})}function m(a,b){var c=a._parentSection;if(!c)return;b=b.data;b&&(b.overview=!c.isActiveAppSection(),b.cursor=null);l(a)}a=function(a){"use strict";babelHelpers.inheritsLoose(c,a);function c(c){var d;d=a.call(this,b("ProfileTabUtils").getIDForCollectionToken(c.token),c.controller)||this;d._contentLoader=null;d._cursor=0;d._importerState=c.importer_state;d._isFrozen=!1;d._isFullyLoaded=!1;d._itemPlaceholderMarkup=null;d._order=c.order;d._rootClass=c.root_class;d._sortContent=null;d._tabCount=c.tab_count>0?c.tab_count:0;d._tabNode=c.tab_node;d._token=c.token;d.auxContent=null;d.curationContent=null;d.href=c.href;d.refreshCount();if(!d._tabNode)return babelHelpers.assertThisInitialized(d);b("ge")(d.nodeID)?b("Event").listen(d._tabNode,"click",l.bind(null,babelHelpers.assertThisInitialized(d))):window.setTimeout(function(){b("promiseDone")(function(){return b("regeneratorRuntime").async(function(a){while(1)switch(a.prev=a.next){case 0:a.next=2;return b("regeneratorRuntime").awrap(d.createTriggerLoader());case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}},null,this)}())},0);return d}var d=c.prototype;d.reset=function(){a.prototype.reset.call(this),this.disableContentLoader(),this._itemPlaceholderMarkup=null,this._sortContent=null,this._tabNode=null,this.auxContent=null,this.curationContent=null};d.addContentLoader=function(a,c,d){var e,f,g,h;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:this._cursor=c;e={node:a,type:b("TriggerablePageletLoader").TRIGGER_ONVISIBLE,onVisibleBuffer:null,onVisibleStrict:!1};b("CSS").matchesSelector(a,"._3t3")&&!d?e.type=b("TriggerablePageletLoader").TRIGGER_CLICK:this._isFrozen&&!d?(b("DOM").remove(a),e.node=b("TimelineDynamicSectionMarkup").pager.cloneNode(!0),b("DOM").appendContent(this.getNode(),e.node),e.type=b("TriggerablePageletLoader").TRIGGER_CLICK):(e.onVisibleBuffer=i,e.onVisibleStrict=!0,e.type=b("TriggerablePageletLoader").TRIGGER_ONVISIBLE);e.type===b("TriggerablePageletLoader").TRIGGER_CLICK&&(e.callback=b("ProfileOverviewSection").setActiveSectionID.bind(null,this.id));j.next=6;return b("regeneratorRuntime").awrap(this._getDefaultPageletConfig());case 6:f=j.sent,g={append:!0},h=babelHelpers["extends"]({displayCallback:function(a){b("DOM").remove(e.node),a()},options:g},f),this._triggerLoader=null,this._contentLoader=new(b("TriggerablePageletLoader"))(h,[e]);case 11:case"end":return j.stop()}},null,this)};d._createNode=function(){var b=a.prototype._createNode.call(this);b.setAttribute("aria-role","tabpanel");return b};d.createTriggerLoader=function(){var a,c;return b("regeneratorRuntime").async(function(d){while(1)switch(d.prev=d.next){case 0:if(this._pageletConfig){d.next=4;break}d.next=3;return b("regeneratorRuntime").awrap(this._getDefaultPageletConfig());case 3:this._pageletConfig=d.sent;case 4:a=this._pageletConfig,c={callback:m.bind(null,this,a),node:this._tabNode,type:b("TriggerablePageletLoader").TRIGGER_CLICK},this._triggerLoader=new(b("TriggerablePageletLoader"))(a,[c]);case 7:case"end":return d.stop()}},null,this)};d.disableContentLoader=function(){this._contentLoader&&this._contentLoader.disableTriggers()};d.enableContentLoader=function(){var a=this._triggerLoader||this._contentLoader;a&&a.enableTriggers()};d.freeze=function(){var a=this;this._isFrozen=!0;if(!this._contentLoader||this._contentLoader._loading)return;this._contentLoader.removeTriggers(b("TriggerablePageletLoader").TRIGGER_ONVISIBLE);var c=b("DOMQuery").scry(this.getNode(),"._3t3");if(!c.length){var d=b("DOMQuery").scry(this.getNode(),"._359")[0];d.length&&b("promiseDone")(function(){return b("regeneratorRuntime").async(function(c){while(1)switch(c.prev=c.next){case 0:c.next=2;return b("regeneratorRuntime").awrap(a.addContentLoader(d,a._cursor));case 2:return c.abrupt("return",c.sent);case 3:case"end":return c.stop()}},null,this)}())}};d.getCount=function(){return this._tabCount};d._getDefaultPageletConfig=function(){var a,c;return b("regeneratorRuntime").async(function(d){while(1)switch(d.prev=d.next){case 0:d.next=2;return b("regeneratorRuntime").awrap(b("MedleyPageletRequestData").get());case 2:a=d.sent;c=b("nullthrows")(this._parentSection);return d.abrupt("return",{controller:this._controller,data:babelHelpers["extends"]({collection_token:this._token,cursor:this._cursor},a,{order:this._order,overview:!c.isActiveAppSection(),sk:c._sk,importer_state:this._importerState}),node:this.getNode()});case 5:case"end":return d.stop()}},null,this)};d.getRootClass=function(){return this._rootClass};d.flashCountIf=function(){var a=this;!this.isActiveCollection()&&this._tabNode&&(b("CSS").addClass(this._tabNode,"_4-k9"),window.setTimeout(function(){a._tabNode&&b("CSS").removeClass(a._tabNode,"_4-k9")},800))};d.isActiveCollection=function(){return this._parentSection?this._parentSection.getActiveCollection()===this:!1};d.registerAuxContent=function(a){a.nodeType==11&&(a=b("DOM").create("span",null,a));var c=b("nullthrows")(this._parentSection);this._resetAuxContent();this.auxContent=a;c.addAuxContent(this.auxContent);this.auxContent&&b("CSS").conditionShow(this.auxContent,this.isActiveCollection())};d.registerAddCurationContent=function(a,c,d,e,f){var g=this;if(this.curationContent)return;a=a.nodeType==11?b("DOM").create("span",null,a):a;this.curationContent=a;if(!this.isActiveCollection())return;this.curationContentState=c;this._itemPlaceholderMarkup=f;c=b("nullthrows")(this._parentSection);c.addCurationContent(a,this,d);e&&b("TimelineAppSectionCuration").subscribe("toggle_drawer",function(a,b){b.button_clicked==="show"?g.curationContentState="show_items":g.curationContentState="hide"})};d.makeActive=function(a){a&&(b("nullthrows")(this._parentSection).resetMinHeight(),this._resetAuxContent(),this._resetContent()),l(this)};d.nullStateCurationContent=function(){b("nullthrows")(this._parentSection).nullStateCurationContent()};d.refreshCount=function(){if(!this._tabNode)return;var a=b("DOMQuery").find(this._tabNode,"._3d0");this._tabCount>0?b("DOM").setContent(a,b("ads-lib-formatters").formatNumber(this._tabCount,0,b("NumberFormatConfig").numberDelimiter,"")):b("DOM").setContent(a,"")};d._resetAuxContent=function(){this.auxContent&&(b("DOM").remove(this.auxContent),this.auxContent=null)};d._resetContent=function(){var a=this;this._contentLoader&&this._contentLoader.destroy();b("DOM").remove(this.getNode());this._node=null;b("DOM").appendContent(b("DOMQuery").find(b("nullthrows")(this._parentSection).getNode(),"div._3i9"),this.getNode());b("promiseDone")(function(){return b("regeneratorRuntime").async(function(c){while(1)switch(c.prev=c.next){case 0:c.next=2;return b("regeneratorRuntime").awrap(a.addContentLoader(b("DOMQuery").find(a.getNode(),"._359"),0));case 2:return c.abrupt("return",c.sent);case 3:case"end":return c.stop()}},null,this)}())};d._sort=function(a){this._order=a;this._resetContent();a=b("nullthrows")(this._parentSection);var c=b("nullthrows")(a._parentSection);if(!c.isOverviewProfileTab()&&a.isActiveAppSection()){c=b("PageTransitions").getCurrentURI();c.addQueryData({order:this._order});b("PageTransitions").rewriteCurrentURI(b("PageTransitions").getCurrentURI().getUnqualifiedURI(),c)}};d.thaw=function(){this._isFrozen=!1};d.getToken=function(){return this._token};c.addPlaceholderToCollection=function(a,d,e){e=e!==void 0?e:{};var f=b("DOM").scry(d,"._gx7")[0],g="",h="";f&&(g=f.text,h=f.href);f=b("DOM").scry(d,"._gx8 .img")[0];f=f&&f.src;d=b("DOM").scry(d,"._3owb")[0];d=d&&d.getAttribute("data-obj");c.addGenericPlaceholderToCollection(a,Object.assign(e,{entityID:d,imageSrc:f,link:h,title:g}))};c.addGenericPlaceholderToCollection=function(a,d){var e=d.suppressCount,f=d.entityID,g=d.replaceExistingElement;e||this.incrementCount(b("ProfileTabUtils").getIDForCollectionToken(a));if(!f)return;b("ProfileOverviewSection").callWithSection(b("ProfileTabUtils").getIDForCollectionToken(a),function(d){d.inform(c.ADDING_PLACEHOLDER);var e=b("nullthrows")(d._parentSection),h=k(a);if(!h)return;d=d._itemPlaceholderMarkup;if(!d)return;var i=b("DOM").scry(h,'[data-obj="'+f+'"]')[0];d=d.cloneNode(!0);d.setAttribute("data-item",f);if(i&&g)b("DOM").replace(i.parentNode,d);else{if(i)return;!e.isActiveAppSection()&&h.children.length>=j&&b("CSS").addClass(h.children[j-1],"_51k9");b("DOM").prependContent(h,d)}})};c.replaceItem=function(a,d,e){a=b("Parent").bySelector(a,"._620");d=b("DOM").scry(a,'div[data-obj="'+d+'"]')[0];d&&(c.inform(c.NEW_ITEM,{grid:a,newItem:e}),b("DOM").replace(d.parentNode,e))};c.removePlaceholderFromCollection=function(a,c){a=k(a);if(a){c=this.getPlaceholderForItem(c,a);b("DOM").remove(c)}};c.addItemToCollectionAndIncrementCount=function(a,b,c){this.incrementCount(c),this.addItemToCollection(a,b,c)};c.addItemToCollection=function(a,d,e){e=b("ge")(e);if(!e)return;e=b("DOM").scry(e,"._620")[0];var f=e.parentNode.nextSibling;f&&b("CSS").matchesSelector(f,"._3t3")&&b("DOM").remove(e.lastChild);this.inform(c.NEW_ITEM,{grid:e,newItem:a});f=this.getPlaceholderForItem(d,e);if(f){b("DOM").replace(f,a);return}b("DOM").prependContent(e,a)};c.getPlaceholderForItem=function(a,c){c=b("DOM").find(c,'[data-item="'+a+'"]._2804');return c};c.addMultipleToCollection=function(a,b){for(var c in a)this.addItemToCollection(a[c],c,b)};c.createFromArray=function(a){return a.map(function(a){return new c(a)})};c.decrementCount=function(a){b("ProfileOverviewSection").callWithSection(a,function(a){a._tabCount>0&&(a._tabCount--,a.refreshCount(),a.flashCountIf())})};c.enableContentLoader=function(a,c,d){b("ProfileOverviewSection").callWithSection(a,function(a){b("promiseDone")(function(){return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(a.addContentLoader(c,d));case 2:case"end":return e.stop()}},null,this)}())})};c.incrementCount=function(a){b("ProfileOverviewSection").callWithSection(a,function(a){a._tabCount++,a.refreshCount(),a.flashCountIf()})};c.registerAuxContent=function(a,c){b("ProfileOverviewSection").callWithSection(a,function(a){a.registerAuxContent(c)})};c.registerAddCurationContent=function(a,c,d,e,f,g){b("ProfileOverviewSection").callWithSection(a,function(a){a.registerAddCurationContent(c,d,e,f,g)})};c.clickTabNode=function(a){b("ProfileOverviewSection").callWithSection(b("ProfileTabUtils").getIDForCollectionToken(a),function(a){a._triggerLoader&&a._pageletConfig&&a._triggerLoader.addTrigger({callback:m.bind(null,a,a._pageletConfig),node:a._tabNode,type:b("TriggerablePageletLoader").TRIGGER_NOW}),l(a)})};c.setLoaded=function(a){b("ProfileOverviewSection").callWithSection(a,function(a){a.setIsLoaded(!0);var c=b("nullthrows")(a._parentSection);c.inform("loaded",a);c.unsetMinHeight()})};c.setFullyLoaded=function(a){b("ProfileOverviewSection").callWithSection(a,function(a){a._isFullyLoaded=!0;a=b("nullthrows")(a._parentSection);if(a.isActiveAppSection()){a=b("nullthrows")(a._parentSection);a.addSectionTeasers()}})};c.switchToNullStateCurationContent=function(a){b("ProfileOverviewSection").callWithSection(b("ProfileTabUtils").getIDForCollectionToken(a),function(a){a.nullStateCurationContent()})};return c}(b("classWithMixins")(b("TimelineDynamicSection"),b("mixin")(b("TidyArbiterMixin"))));a.NEW_ITEM="TimelineAppCollection/newItem";a.ADDING_PLACEHOLDER="TimelineAppCollection/addingPlaceholder";Object.assign(a,b("TidyArbiterMixin"));e.exports=a}),null);
__d("TimelineMonitor",["Arbiter","Event","Run","Vector","ViewportBounds","ge","queryThenMutateDOM"],(function(a,b,c,d,e,f){var g={},h={},i=0,j=[],k=null,l=!1;function m(){g={},h={},i=0,j.length=0,k&&k.remove(),k=null,l=!1}function n(){k||(k=b("Event").listen(window,"scroll",s)),l||(b("Run").onLeave(m),l=!0),s()}var o=[],p=[];function q(){j.forEach(function(a){var b=t.getSection(a);b&&b!==h[a.id]&&(h[a.id]=b,o.push({section:b}))});var a=b("ViewportBounds").getTop()+b("Vector").getScrollPosition().y;for(var c in g){var d=g[c];(a>=d.boundary&&i<=d.boundary||a<=d.boundary&&i>=d.boundary)&&(g[c].fromAbove=i<a,p.push(g[c]))}i=a}function r(){o.forEach(function(a){b("Arbiter").inform(t.SECTION_CHANGE,a)}),p.forEach(function(a){b("Arbiter").inform(t.BOUNDARY_PASSED,a)}),o.length=0,p.length=0}function s(){b("queryThenMutateDOM")(q,r,"TimelineMonitor/scroll")}var t={BOUNDARY_PASSED:"TimelineMonitor/boundary",SECTION_CHANGE:"TimelineMonitor/change",getSection:function(a){var c=b("ViewportBounds").getTop()+b("Vector").getScrollPosition().y;a=a.childSections.getHead();while(a){if(b("ge")(a.nodeID)&&c<b("Vector").getElementPosition(a.getNode()).y+b("Vector").getElementDimensions(a.getNode()).y)return a;a=a.getNext()}},monitorBoundary:function(a,b){b=b||a,(!g[b]||g[b].boundary!==a)&&(g[b]={boundary:a,id:b},n())},monitorSection:function(a){h[a.id]=null;j.push(a);n();return t.getSection(a)},poke:function(a){s()}};e.exports=t}),null);
__d("TimelinePlacesSubCollection",["cx","Arbiter","CSS","Event","TimelineMapController","tidyEvent"],(function(a,b,c,d,e,f,g){var h="_3s-";a=function(){"use strict";function a(a){this.$1=a.id,this.$2=a.parent_collection,this.$3=a.sub_tab,this.$4=a.entity_id,this.$5=a.collection_token,this.$6=a.profile_id,this.$7=a.places_filter,this.$8=a.city_id,this.$9=null,this.$10=0,this.$11=0}var c=a.prototype;c.hide=function(){this.$3&&b("CSS").hasClass(this.$3,h)&&b("CSS").removeClass(this.$3,h);var a=this.$2.getMapInstanceID();a!=null&&b("Arbiter").inform("TimelineMap/hideCallout",{$12:a},"persistent")};c.show=function(){b("CSS").hasClass(this.$3,h)||b("CSS").addClass(this.$3,h),this.$13(),b("Arbiter").subscribe("AggregatedMap/ready",this.$14(this.$13.bind(this)))};c.getSubTabNode=function(){return this.$3};c.getParentCollection=function(){return this.$2};c.getEntityID=function(){return this.$4};c.$13=function(){var a=this.$2.getMapInstanceID();if(a==null)return;b("Arbiter").inform("TimelineMap/zoomToArea",{$12:a,type:b("TimelineMapController").prototype.TIMELINE_MAP_HOVERCARD_CITY,key:this.$8},"persistent")};c.$14=function(a){return function(b,c){(!c||!c.$12||c.$12===this.$2.getMapInstanceID())&&a(b,c)}.bind(this)};c.$15=function(){return this.getParentCollection().getActiveSubCollection()===this?!0:!1};a.build=function(c,d,e,f,g,h,i){if(c!=null&&d&&e&&e.sub_tab&&e.entity_id!=null&&f&&g!=null&&h!=null&&i!=null){c={id:c,parent_collection:d,sub_tab:e.sub_tab,entity_id:e.entity_id,collection_token:f,profile_id:g,places_filter:h,city_id:i};var j=new a(c);b("tidyEvent")(b("Event").listen(j.getSubTabNode(),"click",function(a){j.getParentCollection().setActiveSubCollection(j)}));return j}return null};return a}();e.exports=a}),null);
__d("TimelinePlacesCollection",["csx","cx","CSS","DOM","DOMDimensions","DOMQuery","MenuItem","ProfileOverviewSection","TimelineAppCollection","TimelinePlacesSubCollection"],(function(a,b,c,d,e,f,g,h){var i=820;a=function(a){"use strict";babelHelpers.inheritsLoose(c,a);function c(b){var c;c=a.call(this,b)||this;c.$TimelinePlacesCollection1=b.token;c.$TimelinePlacesCollection2=null;c.$TimelinePlacesCollection3=null;c.$TimelinePlacesCollection4=[];c.$TimelinePlacesCollection5=null;c.$TimelinePlacesCollection6=null;return c}var d=c.prototype;d.reset=function(){a.prototype.reset.call(this),this.$TimelinePlacesCollection2=null,this.$TimelinePlacesCollection3=null,this.$TimelinePlacesCollection4=[]};d.show=function(){this.$TimelinePlacesCollection2&&b("CSS").show(this.$TimelinePlacesCollection2)};d.hide=function(){this.$TimelinePlacesCollection2&&b("CSS").hide(this.$TimelinePlacesCollection2)};d.setActiveSubCollection=function(a){this.$TimelinePlacesCollection3&&this.$TimelinePlacesCollection3.hide(),this.$TimelinePlacesCollection3=a,this.$TimelinePlacesCollection3&&this.$TimelinePlacesCollection3.show()};d.getSubCollectionWithID=function(a){return 0<=a&&this.$TimelinePlacesCollection4&&a<this.$TimelinePlacesCollection4.length?this.$TimelinePlacesCollection4[a]:null};d.getMapInstanceID=function(){return this.$TimelinePlacesCollection6};d.getActiveSubCollection=function(){return this.$TimelinePlacesCollection3};d.$TimelinePlacesCollection7=function(a){if(!a)throw new Error("Don't provide enough information to register sub-collections.");this.$TimelinePlacesCollection8(a)};d.$TimelinePlacesCollection9=function(a){if(!a.sub_collections_filter)throw Error("No sub-collection filter is specified.");if(a.map_instance_id==null)throw Error("No instance id of the map is specified.");this.$TimelinePlacesCollection6=a.map_instance_id;this.$TimelinePlacesCollection8({filter:a.sub_collections_filter})};d.$TimelinePlacesCollection8=function(a){this.$TimelinePlacesCollection5=babelHelpers["extends"]({},this.$TimelinePlacesCollection5,a);a=this.$TimelinePlacesCollection5;if(!a.sub_collections||!a.sub_collections.length||!a.filter||!this.$TimelinePlacesCollection1||a.profile_id==null||!a.more_popover_menu||!a.more_menu)return;for(var c=0;c<a.sub_collections.length;c++){var d=null,e=a.sub_collections[c].city_id;e&&a.filter[e]&&(d=b("TimelinePlacesSubCollection").build(this.$TimelinePlacesCollection4.length,this,a.sub_collections[c],this.$TimelinePlacesCollection1,a.profile_id,a.filter[e],e));d&&this.$TimelinePlacesCollection4.push(d)}this.$TimelinePlacesCollection4.length&&(this.$TimelinePlacesCollection10(this.$TimelinePlacesCollection4,a.more_popover_menu,a.more_menu),window.setTimeout(function(){this.setActiveSubCollection(this.$TimelinePlacesCollection4[0])}.bind(this),2e3))};d.$TimelinePlacesCollection10=function(a,c,d){var e=b("DOMQuery").find(this.getParent().getNode(),"._33hy");if(!e)return;var f=b("DOM").create("div",{className:"_33hy"});b("DOM").replace(e,f);this.$TimelinePlacesCollection2=f;this.$TimelinePlacesCollection11(f,a,c,d)};d.$TimelinePlacesCollection11=function(a,c,d,e){var f=0;for(var g=0;g<c.length;g++)c[g].getSubTabNode()&&(b("DOM").appendContent(a,c[g].getSubTabNode()),f+=b("DOMDimensions").getElementDimensions(c[g].getSubTabNode()).width);b("DOM").appendContent(a,d);f+=b("DOMDimensions").getElementDimensions(d).width;if(f<=i)b("CSS").hide(d);else{g=c.length-1;while(f>i){if(g<0)return;f-=b("DOMDimensions").getElementDimensions(c[g].getSubTabNode()).width;b("DOM").remove(c[g].getSubTabNode());a=new(b("MenuItem"))({markup:c[g].getSubTabNode()});e.getItemAt(0)?e.addItemBefore(a,e.getItemAt(0)):e.addItem(a);g--}}};c.registerSubCollections=function(a){this.checkCollectionID(a.collection_id),b("ProfileOverviewSection").callWithSection(a.collection_id,function(b){b&&b.$TimelinePlacesCollection7(a)})};c.registerSubCollectionsFilter=function(a){this.checkCollectionID(a.collection_id),b("ProfileOverviewSection").callWithSection(a.collection_id,function(b){b&&b.$TimelinePlacesCollection9(a)})};c.checkCollectionID=function(a){if(a==null)throw new Error("No collection id is specified when trying to access a static function in TimelinePlacesCollection.")};return c}(b("TimelineAppCollection"));e.exports=a}),null);
__d("TimelineSmartInsert",["Run","UserAgent_DEPRECATED","Vector"],(function(a,b,c,d,e,f){var g=100;function h(a){return a==="viewport"?b("Vector").getViewportDimensions().y:a}var i=!1,j=!1;function k(){if(j)return;b("Run").onLeave(l);j=!0}function l(){i=!1,j=!1}a={run:function(a,c,d){k();if(!i||b("UserAgent_DEPRECATED").ie()<=8){c();return}var e=a.offsetHeight;c();c=a.offsetHeight;var f=b("Vector").getScrollPosition().y;a=b("Vector").getElementPosition(a).y;c!==e&&a<f&&a+e<f+h(d||g)&&window.scrollBy(0,c-e)},enable:function(){i=!0}};e.exports=a}),null);
__d("TimelineAppSection",["csx","cx","fbt","regeneratorRuntime","AppSectionCurationState","Arbiter","CSS","DOM","DOMQuery","DOMScroll","MedleyPageletRequestData","PageletSet","ProfileOverviewSection","ProfileTabUtils","Style","TidyArbiterMixin","TimelineAppCollection","TimelineAppSectionCuration","TimelineDynamicSection","TimelineMonitor","TimelinePlacesCollection","TimelineSmartInsert","TriggerablePageletLoader","ViewportBounds","classWithMixins","ge","mixin","nullthrows"],(function(a,b,c,d,e,f,g,h,i){var j=500,k=2,l=500,m=10,n="_5bry",o="_3s-",p=b("DOM").create("div",{className:"_3s_"});function q(a,c){return c.map(function(c){return b("ProfileTabUtils").isMapTab(a)?new(b("TimelinePlacesCollection"))(c):new(b("TimelineAppCollection"))(c)})}function r(){return b("DOM").create("span",{className:"_3s18"},[b("DOM").create("a",{className:"_3s19",href:"#"},i._("More")),b("DOM").create("span",{className:"_3s1a"})])}var s={notes:295,events:345,photos:555,app_quoraapp:569,fitness:619,friends:603,app_foodspotting:621,map:621,favorites:645,app_pinterestapp:699,app_instapp:699,books:699,movies:699,tv:699,music:725};function t(a){return s[a.replace("pagelet_timeline_medley_","")]}a=function(a){"use strict";babelHelpers.inheritsLoose(c,a);function c(c,d,e,f){c=a.call(this,b("ProfileTabUtils").getIDForSectionKey(d),c,e)||this;c._sk=d;c._title=f;return c}var d=c.prototype;d.registerCollections=function(a,c,d){this._tabObj=null;if(this.childSections){var e=this.childSections.getHead();while(e)e._resetAuxContent(),e=e.getNext()}q(a,c).forEach(this.appendSection,this);e=b("nullthrows")(this.childSections.get(d));this.setActiveCollection(e);e.setIsLoaded(!0)};d.reset=function(){a.prototype.reset.call(this),this._tabObj=null,this._data=null};d._createNode=function(){var c=a.prototype._createNode.call(this);c.setAttribute("aria-labelledby","medley_header_"+this._sk);c.setAttribute("aria-role","region");b("DOM").prependContent(c,b("DOM").create("div",{className:"_3cz"},[this._title,b("DOM").create("div",{className:"_3dc","aria-role":"tablist"})]));this.resetMinHeight(c);return c};d.addAuxContent=function(a){var c=b("DOMQuery").scry(this.getNode(),"._6ph")[0];c&&b("DOM").appendContent(c,a);this._activeCollection&&this._checkTabDimensions(this._activeCollection)};d.nullStateCurationContent=function(){if(!this._nullStateContent)return;var a=b("DOMQuery").find(this.getNode(),"._1_cb");b("DOM").replace(a.firstChild,this._nullStateContent)};d.addCurationContent=function(a,c,d,e){e=e?e:0;var f=b("DOMQuery").scry(this.getNode(),"._1_cb");f=e<f.length?f[e]:null;f&&b("DOM").appendContent(f,a);d&&(this._nullStateContent=d);this.checkCurationContent(c)};d.createTriggerLoader=function(a){var c,d,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:c=function(a){var c=b("nullthrows")(this._parentSection);c._lastLoadedSection=this;this.setIsLoaded(!0);b("TimelineSmartInsert").enable();b("TimelineSmartInsert").run(this.getNode(),function(){a(),this.unsetMinHeight(),b("TimelineMonitor").poke(c.id)}.bind(this),"viewport")}.bind(this);d=this._data;if(d){f.next=8;break}f.next=5;return b("regeneratorRuntime").awrap(b("MedleyPageletRequestData").get());case 5:e=f.sent,d=babelHelpers["extends"]({sk:this._sk},e,{overview:!this.isActiveAppSection()}),this._data=d;case 8:this._triggerLoader=new(b("TriggerablePageletLoader"))({controller:this._controller,data:d,displayCallback:c,options:{constHeight:!0},node:this.getNode()},[{node:this.getNode(),onVisibleBuffer:j,onVisibleStrict:!0,type:a?b("TriggerablePageletLoader").TRIGGER_NOW:b("TriggerablePageletLoader").TRIGGER_ONVISIBLE}]);case 9:case"end":return f.stop()}},null,this)};d.freeze=function(){b("CSS").addClass(this.getNode(),"_c4e"),b("ge")(this.nodeID)&&!this.isLoaded()&&(this._triggerLoader&&this._triggerLoader.disableTriggers()),this.freezeChildren()};d.isActiveAppSection=function(){return this._parentSection?this._parentSection._sk===this._sk:!1};d.getActiveCollection=function(){return this._activeCollection};d.remove=function(){b("PageletSet").hasPagelet(this.id)&&b("PageletSet").removePagelet(this.id),b("DOM").remove(this.getNode()),this._parentSection&&this._parentSection.removeChildSection(this.id)};d.setActiveCollection=function(a){var c=this._activeCollection;if(c===a||!a._tabNode)return;if(c){this.hideCollection(c);c=b("DOM").scry(c._tabNode,"div._3s_");var d=p;c.length>0&&(d=c[0]);b("DOM").appendContent(a._tabNode,d.cloneNode(!0));c.forEach(b("DOM").remove)}this._activeCollection=a;this.showCollection(a)};d.hideCollection=function(a){if(a){var c=a.getRootClass();c&&b("CSS").removeClass(this.getNode(),c);this.resetMinHeight();a.disableContentLoader();b("CSS").hide(a.getNode());a.auxContent&&b("CSS").hide(a.auxContent);a.curationContent&&b("CSS").hide(a.curationContent);c=a._tabNode;c&&(b("CSS").removeClass(c,o),c.setAttribute("aria-selected","false"))}};d.showCollection=function(a){var d=a.getRootClass();d&&b("CSS").addClass(this.getNode(),d);a.auxContent&&b("CSS").show(a.auxContent);this.checkCurationContent(a);a._tabNode&&b("CSS").addClass(a._tabNode,o);this._checkTabDimensions(a);c.inform("changeCollection");b("ge")(a.nodeID)||b("DOM").appendContent(b("DOMQuery").find(this.getNode(),"div._3i9"),a.getNode());b("CSS").show(a.getNode());a.isLoaded()&&this.unsetMinHeight();a._tabNode&&a._tabNode.setAttribute("aria-selected","true");a.enableContentLoader();d=b("ProfileTabUtils").getIDForSectionKey(this._sk);a=b("TimelineAppSectionCuration").getSectionState(d);a&&b("TimelineAppSectionCuration").refreshState(a,d)};d.resetMinHeight=function(a){a=a||this.getNode();var b=t(this.id)||a.offsetHeight-k;b>0&&this._updateScrollAfterHeight(a,b)};d.scrollTo=function(a,c){var d=b("nullthrows")(this._parentSection),e=b("ViewportBounds").getElementPosition(this.getNode());e.y-=a||m;c&&d.toggleScrollLoad(!1);b("DOMScroll").scrollTo(e,l,null,null,0,function(){e=b("ViewportBounds").getElementPosition(this.getNode()),e.y-=a||m,b("DOMScroll").scrollTo(e),c&&d.toggleScrollLoad(!0)}.bind(this))};d.thaw=function(){b("CSS").removeClass(this.getNode(),"_c4e"),this._triggerLoader&&this._triggerLoader.enableTriggers(),this.thawChildren()};d.unsetMinHeight=function(){this._updateScrollAfterHeight(this.getNode(),0)};d._updateScrollAfterHeight=function(a,c){b("Style").set(a,"min-height",c+"px"),b("Arbiter").inform("reflow")};d.checkCurationContent=function(a){var c=b("DOMQuery").scry(this.getNode(),"._2zh3")[0];c&&(a.curationContent?(b("CSS").show(c),a.curationContent&&b("CSS").show(a.curationContent),a.curationContentState&&a===this._activeCollection&&b("TimelineAppSectionCuration").informState(a.curationContentState,this.id,a.getToken(),a.curationContentState!=b("AppSectionCurationState").hide)):(b("CSS").hide(c),b("TimelineAppSectionCuration").informState(b("AppSectionCurationState").hide,this.id,a.getToken(),!0)))};d._getTabObj=function(){var a=this._tabObj;a||(a={aux:b("DOM").find(this.getNode(),"._6ph"),items:[],nav:b("DOM").find(this.getNode(),"._1_ca"),tabs:b("DOM").find(this.getNode(),"._3dc"),width:0},b("CSS").addClass(a.tabs,"_5brz"));this._tabObj=a;return a};d._checkTabDimensions=function(a){var c=this._getTabObj(),d=c.nav.offsetWidth-c.aux.offsetWidth;if(d>=c.width){if(!c.hidden&&d-c.tabs.offsetWidth>=0)return;b("CSS").removeClass(c.tabs,n)}c.hidden&&a._tabNode&&a._tabNode.parentNode===c.overflow&&c.dropdown&&(b("DOM").prependContent(c.overflow,c.dropdown.previousSibling),b("DOM").insertBefore(c.dropdown,a._tabNode));if(d-c.tabs.offsetWidth>=0&&!c.hidden)return;var e=c.items.length;if(e&&c.hidden){for(var f=0;f<e;f++)b("DOM").appendContent(c.tabs,c.items[f]);b("DOM").remove(c.dropdown)}b("CSS").conditionClass(c.tabs,n,d-c.tabs.offsetWidth<0);c.width=d;c.hidden=0;if(d-c.tabs.offsetWidth>=0)return;c.dropdown||(c.dropdown=r(),c.overflow=b("DOM").find(c.dropdown,"._3s1a"),c.items=b("DOM").scry(this.getNode(),"._3c_"),e=c.items.length);b("DOM").appendContent(c.tabs,c.dropdown);f=0;var g=0;for(var e=e-1;e>0&&f<=0;e--)c.items[e]!==a._tabNode&&(b("DOM").prependContent(c.overflow,c.items[e]),f=d-c.tabs.offsetWidth,g++);c.hidden=g};c.createFromArray=function(a){return a.map(function(a){return new c(a.controller,a.sk,a.label,a.title)})};c.registerCollections=function(a,c,d){b("ProfileOverviewSection").callWithSection(b("ProfileTabUtils").getIDForSectionKey(a),function(b){b.registerCollections(a,c,d)})};c.removeEmptyAppSection=function(a){b("ProfileOverviewSection").callWithSection(b("ProfileTabUtils").getIDForSectionKey(a),function(a){a.remove()})};return c}(b("classWithMixins")(b("TimelineDynamicSection"),b("mixin")(b("TidyArbiterMixin"))));Object.assign(a,b("TidyArbiterMixin"));e.exports=a}),null);
__d("TimelinePlacesSection",["TimelineAppSection","TimelinePlacesCollection"],(function(a,b,c,d,e,f){a=function(a){"use strict";babelHelpers.inheritsLoose(c,a);function c(b,c,d,e){return a.call(this,b,c,d,e)||this}var d=c.prototype;d.hideCollection=function(c){a.prototype.hideCollection.call(this,c),c instanceof b("TimelinePlacesCollection")&&c.hide()};d.showCollection=function(c){a.prototype.showCollection.call(this,c),c instanceof b("TimelinePlacesCollection")&&c.show()};return c}(b("TimelineAppSection"));e.exports=a}),null);
__d("TimelineMedley",["csx","cx","regeneratorRuntime","Arbiter","CSS","DOM","DOMQuery","MedleyPageletRequestData","PageTransitions","ProfileNavigation","ProfileOverviewSection","ProfileTabUtils","ScriptPath","TimelineAppSection","TimelineController","TimelineMonitor","TimelinePlacesSection","TimelineURI","TriggerablePageletLoader","URI","ViewportBounds","$","ge","getElementPosition","nullthrows","promiseDone"],(function(a,b,c,d,e,f,g,h){var i,j=6,k=2,l=!1;function m(a){return a.map(function(a){var c=a.controller,d=a.sk,e=a.label;a=a.title;return b("ProfileTabUtils").isMapTab(d)?new(b("TimelinePlacesSection"))(c,d,e,a):new(b("TimelineAppSection"))(c,d,e,a)})}function n(a){b("ScriptPath").set(b("ProfileNavigation").getScriptPath(a),null,{entity_id:b("TimelineController").getProfileID(),profile_session_id:b("TimelineController").getSessionToken()})}a=function(a){"use strict";babelHelpers.inheritsLoose(c,a);function c(c,d,e){var f;f=a.call(this,"timeline-medley")||this;f._transitionHandler=function(a){var c=a.getQueryData();if(Object.prototype.hasOwnProperty.call(c,"theater")){b("Arbiter").subscribeOnce("PhotoSnowlift.CLOSE",function(){return b("PageTransitions").registerHandler(f._transitionHandler,j)});return!1}c=f._transitionHandlerImpl(a);c||f.reset();return c};f._sectionBreaker=e.breaker;m(c).forEach(f.appendSection,babelHelpers.assertThisInitialized(f));b("TimelineMonitor").monitorSection(babelHelpers.assertThisInitialized(f));e=b("nullthrows")(f.childSections.get(b("ProfileTabUtils").getIDForSectionKey(d)));f._lastLoadedSection=e.setIsLoaded(!0);b("ProfileOverviewSection").setActiveSectionID(f._lastLoadedSection.id);l&&f.isOverviewProfileTab()&&f.addSectionPlaceholders();c=(i||(i=b("URI"))).getNextURI();f._vanity=b("TimelineURI").getVanityFromURI(c);f._sk=b("TimelineURI").getTabKeyFromURI(c);b("PageTransitions").registerHandler(f._transitionHandler,j);f._monitorListener=b("Arbiter").subscribe(b("TimelineMonitor").SECTION_CHANGE,function(a,c){c.section instanceof b("TimelineAppSection")&&n(c.section._sk)});return f}var d=c.prototype;d.reset=function(){a.prototype.reset.call(this),b("MedleyPageletRequestData").reset(),b("PageTransitions").removeHandler(this._transitionHandler,j),b("ProfileOverviewSection").resetGlobalState(),this._monitorListener&&this._monitorListener.unsubscribe(),l=!1};d.addSectionTeasers=function(){this.isOverviewProfileTab()||(b("CSS").removeClass(this.getNode(),"_c4f"),this.thawChildren(),this.addSectionPlaceholders(),this.addSectionBreak())};d.addUpcomingSectionPlaceholders=function(a,b){b=b||k;while(a=a.getNext())if(!this.addSectionPlaceholder(a,a.getPrev())&&--b<=0)break};d.addSectionPlaceholder=function(a,c,d){if(!a.isLoaded()&&b("ge")(a.nodeID))return!1;if(!b("ge")(a.nodeID)){b("DOM").insertAfter(c.getNode(),a.getNode());a.createTriggerLoader(d);return!1}return!0};d.addSectionBreak=function(){var a=this.childSections.getHead();this._lastLoadedSection.getNext()&&a?b("DOM").insertAfter(a.getNode(),this._sectionBreaker):b("DOM").remove(this._sectionBreaker)};d.removeChildSection=function(a){this.childSections.remove(a),this.childSections.getCount()==1&&b("DOM").remove(this._sectionBreaker)};d.addSectionPlaceholders=function(){this.addUpcomingSectionPlaceholders(this._lastLoadedSection)};d.getNode=function(){return b("$")(this.id)};d.isOverviewProfileTab=function(){return b("ProfileTabUtils").isOverviewTab(this._sk)};d.toggleScrollLoad=function(a){l=a,a?(this.thawChildren(),this.addSectionPlaceholders()):this.freezeChildren()};d._transitionHandlerImpl=function(a){var c=this;if(b("TimelineURI").getVanityFromURI(a)!==this._vanity)return!1;var d=b("TimelineURI").getTabKeyFromURI(a);if(b("ProfileTabUtils").isTimelineTab(d)||b("ProfileTabUtils").isTimelineOverviewTab(d))return!1;if(b("ProfileTabUtils").isOverviewTab(d))return!1;else{var e=function(){var e=a.getQueryData();if(!e.next_cursor)return{v:!1};var f=c.childSections.getHead();while(f){if(f._sk===d){if(!f._activeCollection||!b("DOMQuery").scry(f._activeCollection.getNode(),"._3t3")[0])return{v:!1};b("Arbiter").inform("save_facebar_query",!0);window.setTimeout(function(){b("promiseDone")(function(){return b("regeneratorRuntime").async(function(a){while(1)switch(a.prev=a.next){case 0:if(!f){a.next=3;break}a.next=3;return b("regeneratorRuntime").awrap(c._transitionToSection(f,e));case 3:case"end":return a.stop()}},null,this)}())},0);return{v:!0}}f=f.getNext()}}();if(typeof e==="object")return e.v}return!1};d._transitionToSection=function(a,c){var d,e,f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:d=b("getElementPosition")(a.getNode()).y-b("ViewportBounds").getTop();b("DOM").scry(a.getNode(),"._51k9").forEach(function(a){b("CSS").removeClass(a,"_51k9")});this._sk=a._sk;e=b("nullthrows")(a._activeCollection);b("ProfileOverviewSection").setActiveSectionID(a.id);a.thaw();b("CSS").addClass(this.getNode(),"_c4f");this.freezeChildren();f=b("DOMQuery").find(e.getNode(),"._3t3");h.next=11;return b("regeneratorRuntime").awrap(e.addContentLoader(f,c.next_cursor));case 11:e._contentLoader&&e._contentLoader.load({node:f,type:b("TriggerablePageletLoader").TRIGGER_NOW});g=this.childSections.getHead();while(g&&g.id!==a.id)g.remove(),g=this.childSections.getHead();b("ProfileOverviewSection").inform("Medley/transitionToSection",a.id);a.scrollTo(d<0?d:0);this._sk&&n(this._sk);b("PageTransitions").transitionComplete();case 18:case"end":return h.stop()}},null,this)};c.scrollToSection=function(a,c,d){b("ProfileOverviewSection").callWithSection(a,function(a){a.scrollTo(c,d)})};c.toggleScrollLoad=function(a){l=a,b("ProfileOverviewSection").callWithSection("timeline-medley",function(b){b.toggleScrollLoad(a)})};return c}(b("ProfileOverviewSection"));e.exports=a}),null);