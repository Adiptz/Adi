if (self.CavalryLogger) { CavalryLogger.start_js(["npDsS"]); }

__d("LiveVideoUFIAnnouncement.react",["cx","FlexibleBlock.react","InlineBlock.react","JSResource","React","UFI2CometRelayCreateFragmentContainer","UFICommentLiveVideoAnnouncementImage.react","lazyLoadComponent","nullthrows","LiveVideoUFIAnnouncement_announcement.graphql"],(function(a,b,c,d,e,f,g){"use strict";var h,i=b("React");b("UFI2CometRelayCreateFragmentContainer").graphql;var j=b("lazyLoadComponent")(b("JSResource")("UFILiveVideoAnnouncementCTAContainer.react").__setRef("LiveVideoUFIAnnouncement.react"));c=b("React");var k=c.useMemo;h!==void 0?h:h=b("LiveVideoUFIAnnouncement_announcement.graphql");function l(a){if(a.length>=8){var b=a.replace("#","");return"#"+b.slice(2)+b.slice(0,2)}return"#"+a.replace("#","")}function a(a){var c=k(function(){var c;return{accentColor:a.announcement.accent_color!=null?l(a.announcement.accent_color):"#B2B2B2",body:a.announcement.message,broadcastSubscriptionStatus:b("nullthrows")(a.announcement.broadcast_subscription_status,"Expected a `broadcast_subscription_status`."),ctaAction:b("nullthrows")(a.announcement.cta_action,"Expected a `cta_action`."),ctaGlyphName:a.announcement.cta_glyph,ctaGlyphNameOff:a.announcement.cta_glyph_off,ctaLink:a.announcement.cta_link,ctaState:Boolean(a.announcement.cta_state),ctaTextOff:a.announcement.cta_text_off||"",ctaTextOn:a.announcement.cta_text_on||"",ftentidentifier:a.legacyFeedbackID,glyphName:b("nullthrows")(a.announcement.glyph_name,"Expected a `glyph_name`."),id:a.legacyFeedbackID+((c=a.announcement.name)!=null?c:"UNKNOWNNAME")+((c=a.announcement.level)!=null?c:"UNKNOWNLEVEL"),image:a.announcement.image,isAnnouncement:!0,isJoinEvent:!1,targetID:(c=a.announcement.target)==null?void 0:c.id}},[a.announcement,a.legacyFeedbackID]);return i.jsx(b("FlexibleBlock.react"),{className:"_7m_7",flex:b("FlexibleBlock.react").FLEX.right,left:i.jsx("div",{className:"_7m_8",children:i.jsx(b("UFICommentLiveVideoAnnouncementImage.react"),{accentColor:c.accentColor,contextArgs:null,glyphName:c.glyphName,image:c.image,isJoinEvent:!1})}),right:i.jsx("div",{children:i.jsxs("div",{className:"_7m_9",children:[i.jsx(b("InlineBlock.react"),{alignv:"middle",height:0,children:a.announcement.message}),i.jsx(i.Suspense,{fallback:i.jsx("span",{}),children:i.jsx(j,{comment:c,contextArgs:null})})]})})})}e.exports=a}),null);
__d("LiveVideoUFIAnnouncementFetcher",["regeneratorRuntime","ActorURIConfig","ErrorUtils","RelayFBOperationLoader","RelayFBResponseCache","RelayModern","RelayRuntime","ServerTime","SubscriptionList","clearTimeout","createRelayFBNetwork","createRelayFBNetworkFetch","createRelayFBSubscribeFunction","resolveImmediate","setTimeoutAcrossTransitions","stableStringify","LiveVideoUFIAnnouncementFetcherQuery.graphql"],(function(a,b,c,d,e,f){"use strict";var g,h,i=b("RelayModern").fetchQuery;b("RelayModern").graphql;var j=b("RelayRuntime").Environment,k=b("RelayRuntime").RecordSource,l=b("RelayRuntime").Store,m=g!==void 0?g:g=b("LiveVideoUFIAnnouncementFetcherQuery.graphql"),n={};a=function(){var a=c.prototype;a.$11=function(){var a=this,c=this.$3,d=this.$2.length>0?3e4:1e4;d=c==null?0:Math.max(0,d-(Date.now()-c));d===0?this.$12():this.$5=b("setTimeoutAcrossTransitions")(function(){a.$12()},d)};a.$12=function(){var a,c,d,e,f,g,h,j,k,l,n,o,p;return b("regeneratorRuntime").async(function(q){while(1)switch(q.prev=q.next){case 0:q.prev=0;c=this.$2;if(!(c.length>0)){q.next=6;break}a=c.shift();q.next=12;break;case 6:q.next=8;return b("regeneratorRuntime").awrap(i(this.$1,m,this.$9,{force:!0}));case 8:f=q.sent,g=(d=f.video)==null?void 0:(e=d.announcements)==null?void 0:e.edges,h=g&&g.map(function(a){a=a.node;return a}).filter(Boolean),h!=null&&h.length>0&&(a=h.shift(),(j=this.$2).push.apply(j,h));case 12:this.$3=Date.now();a&&((k=a,l=k.level,n=k.name),o=this.$6.findIndex(function(a){a=a.node;return a.level===l&&a.name===n}),o!==-1?this.$6[o].node=a:(p={node:a,time:Math.floor(b("ServerTime").getMillis()/1e3)},this.$6.push(p)),this.$8.fireCallbacks([].concat(this.$6)));this.$4===!1&&this.$11();q.next=21;break;case 17:q.prev=17,q.t0=q["catch"](0),this.$3=Date.now(),this.$4===!1&&this.$11();case 21:case"end":return q.stop()}},null,this,[[0,17]])};function c(a,c){var d=this;this.$2=[];this.$3=null;this.$4=!1;this.$5=null;this.$6=[];this.$7=null;this.$10=function(){d.$4=!1,d.$7=Date.now(),d.$11()};this.$13=function(){d.$4=!0,d.$5!=null&&(b("clearTimeout")(d.$5),d.$5=null)};var e=new k();e=new l(e,{gcReleaseBufferSize:10,gcScheduler:b("resolveImmediate"),operationLoader:b("RelayFBOperationLoader"),queryCacheExpirationTime:1e3*60*5});var f=b("createRelayFBNetwork")(b("createRelayFBNetworkFetch")({getAdditionalData:function(){var c;return c={},c[b("ActorURIConfig").PARAMETER_ACTOR]=a,c},queryResponseCache:b("RelayFBResponseCache")}),b("createRelayFBSubscribeFunction")({}));this.$1=new j({configName:"LiveVideoUFIAnnouncementFetcherEnvironment",network:f,operationLoader:b("RelayFBOperationLoader"),store:e});this.$8=new(b("SubscriptionList"))(this.$10,this.$13);this.$9=c}a.subscribe=function(a){a=(h||(h=b("ErrorUtils"))).guard(a,"LiveVideoUFIAnnouncementFetcher#subscribe");this.$6.length>0&&a(this.$6);return this.$8.add(a)};c.getInstance=function(a,d){var e=b("stableStringify")([a,d]),f=n[e];f==null&&(f=new c(a,d),n[e]=f);return f};return c}();e.exports=a}),null);
__d("UFI2LiveVideoCommentCreateSubscription",["RelayModern","RelayRuntime","displayCommentsConnectionCountUpdater","nodeIsInConnection","UFI2LiveVideoCommentCreateSubscription.graphql"],(function(a,b,c,d,e,f){"use strict";var g;b("RelayModern").graphql;var h=b("RelayModern").requestSubscription,i=b("RelayRuntime").ConnectionHandler,j=g!==void 0?g:g=b("UFI2LiveVideoCommentCreateSubscription.graphql");function a(a,c,d){var e=c.input.feedback_id;return h(a,{subscription:j,variables:c,updater:function(a){var c=a.getRootField("live_video_comment_create_subscribe");if(c==null)return;c=c.getLinkedRecord("comment");if(c==null)return;var d=c.getLinkedRecord("author");if(d==null)return;d=a.get(e);if(d==null)return;d=i.getConnection(d,"LiveFeedStoryCowatchingCommentList_top_level_comments");if(d==null)return;if(b("nodeIsInConnection")(d,c))return;c=i.createEdge(a,d,c,c.getType());if(c==null)return;i.insertEdgeBefore(d,c);b("displayCommentsConnectionCountUpdater").increment({feedbackId:e,store:a})}})}e.exports={subscribe:a}}),null);
__d("UFI2LiveVideoCommentDeleteSubscription",["RelayModern","RelayRuntime","displayCommentsConnectionCountUpdater","UFI2LiveVideoCommentDeleteSubscription.graphql"],(function(a,b,c,d,e,f){"use strict";var g;b("RelayModern").graphql;var h=b("RelayModern").requestSubscription,i=b("RelayRuntime").ConnectionHandler,j=g!==void 0?g:g=b("UFI2LiveVideoCommentDeleteSubscription.graphql");function a(a,c){var d={input:{feedback_id:c}};return h(a,{subscription:j,variables:d,updater:function(a){var d=a.getRootField("comment_delete_subscribe");if(d==null)return;d=d.getValue("deleted_comment_id");if(d==null||typeof d!=="string")return;var e=a.get(c);if(e==null)return;e=i.getConnection(e,"LiveFeedStoryCowatchingCommentList_top_level_comments");if(e==null)return;i.deleteNode(e,d);b("displayCommentsConnectionCountUpdater").decrement({feedbackId:c,store:a});k(a,c,d)}})}function k(a,b,c){b=a.get(b);if(b==null)return;b=b.getLinkedRecord("latest_pinned_comment_event");if(b==null)return;var d=b.getLinkedRecord("pinned_comment");if(d==null)return;d=d.getValue("id");if(d===c){d=String(b.getValue("id"));c=a.get(d);if(c==null)return;c.setValue(null,"pinned_comment")}}e.exports={subscribe:a}}),null);
__d("UFI2LiveVideoPinnedCommentEventCreateSubscription",["RelayModern","UFI2LiveVideoPinnedCommentEventCreateSubscription.graphql"],(function(a,b,c,d,e,f){"use strict";var g;b("RelayModern").graphql;var h=b("RelayModern").requestSubscription,i=g!==void 0?g:g=b("UFI2LiveVideoPinnedCommentEventCreateSubscription.graphql");function a(a,b,c,d){b={input:{video_id:b.video_id},feedbackID:c,useDefaultActor:d};return h(a,{subscription:i,variables:b,updater:function(a){var b=a.getRootField("pinned_comment_event_create_subscribe");if(b==null)return;b=b.getLinkedRecord("pinned_comment_event");if(b==null)return;a=a.get(c);if(a==null)return;a.setLinkedRecord(b,"latest_pinned_comment_event")}})}e.exports={subscribe:a}}),null);
__d("useLiveFeedStoryVideoTimestamp",["requireCond","cr:957426"],(function(a,b,c,d,e,f){"use strict";e.exports=b("cr:957426")}),null);
__d("LiveFeedStoryUFIRenderer.react",["cx","fbt","invariant","BootloadedComponent.react","Bootloader","CowatchingUFIConstants","FBLogger","FeedStoryUFISummary.react","JSResource","LiveFeedStoryCowatchingCommentList.react","LiveFeedStoryLiveStreamingCommentList.react","LiveFeedStoryPinnedComment.react","React","RelayModern","RelayRuntime","RelayUFI2Environment","SiteData","SubscriptionsHandler","UFI2ActorSelector.react","UFI2Comment.react","UFI2CommentActionLink.react","UFI2CommentDisabledNotice.react","UFI2CommentsFilterFallbackWarning.react","UFI2CommentsList.react","UFI2CommentsPager.react","UFI2Composer.react","UFI2CreateCommentMutation","UFI2FeedbackCommentReactSubscription","UFI2FeedbackReactSubscription","UFI2HiddenCommentsPlaceholder.react","UFI2LazyCodedErrorDialog.react","UFI2PaginationProgressIndicator.react","UFI2PrivateReplyActionLink.react","UFI2ReactionActionLink.react","UFI2RealtimeContainer.react","UFI2RealtimeRoot.react","UFI2RepliesCollapser.react","UFI2RepliesExpander.react","UFI2ScrollHoldingContainer.react","UFI2ShareActionLink.react","UFI2SurfaceContainerContext","UFI2TypingIndicator.react","UFI2ViewOption","UFI2ViewOptionsSelector.react","UFIVideoPlayerRegistry","VideoTimestampedCommentsConnectionHandler","XUISpinner.react","createUFI2AssociateReplyWithParentComposerPlugin","createUFI2ComposerTipPlugin","createUFI2DelightsComposerPlugin","createUFI2EmojiComposerPlugin","createUFI2EmoticonsComposerPlugin","createUFI2GIFComposerPlugin","createUFI2HashtagComposerPlugin","createUFI2LiveTypingBroadcastComposerPlugin","createUFI2MediaUploadComposerPlugin","createUFI2MentionsComposerPlugin","createUFI2PrefillMentionComposerPlugin","createUFI2SetReplyClickedComposerPlugin","createUFI2StarsComposerPlugin","createUFI2StickersComposerPlugin","cxMargin","edgeIsInConnection","getCommentCreateMutationPropertiesFromTrackingData","getViewportViewDurationPropertiesFromTrackingData","gkx","isCommentFresh","isCommentTokenOrFBID","lazyLoadComponent","logCommentViewportViewDuration","nullthrows","promiseDone","useInterval","useUFIVPVDEndpoint","LiveFeedStoryUFIRenderer_feedback.graphql","LiveFeedStoryUFIRenderer_group.graphql","LiveFeedStoryUFIRenderer_shareableConfig.graphql"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k,l,m=b("CowatchingUFIConstants").LIVE_FEED_MAX_SHOWN_COMMENTS,n=b("React");a=b("React");var o=a.useEffect,p=a.useRef,q=a.useState;c=b("RelayModern").createFragmentContainer;var r=b("RelayModern").fetchQuery;b("RelayModern").graphql;var s=b("RelayRuntime").ConnectionHandler,t=b("SiteData").pr,u=b("BootloadedComponent.react").create(b("JSResource")("UFI2AddCommentLink.react").__setRef("LiveFeedStoryUFIRenderer.react")),v=b("BootloadedComponent.react").create(b("JSResource")("UFI2CommentingAsConstituentHeader.react").__setRef("LiveFeedStoryUFIRenderer.react")),w=b("lazyLoadComponent")(b("JSResource")("UFI2CommentEditor.react").__setRef("LiveFeedStoryUFIRenderer.react"));function x(a){return a===1}function y(a){var c=a.comment,d=a.group;a=a.streamLastViewTime;if(b("isCommentFresh")(c))return!0;if(d!=null&&a!=null){d=c.created_time;if(d!=null)return a<d}return!1}function z(a){return b("RelayUFI2Environment").forActor(a)}function A(a){var c,d=a.feedback,e=a.group,f=d.viewer_actor,g=d.mentions_datasource_js_constructor_args_json,h=f&&f.id,i=z(h);return{composerPluginProps:{initialPlugins:[d.composer_tip!=null?b("createUFI2ComposerTipPlugin")({composer_tip:d.composer_tip}):null,e?b("createUFI2MentionsComposerPlugin")({maxResults:5,mentions_datasource_js_constructor_args_json:g,typeaheadViewProps:{__type:"GroupMentions",sortFn:function(a,b){var c=a.getAuxiliaryData().renderType,d=b.getAuxiliaryData().renderType;if(c===d){var e=a.getAuxiliaryData().indexRank,f=b.getAuxiliaryData().indexRank;if(e===-1&&f!==-1)return-1;else if(e!==-1&&f===-1)return 1;else return a.getOrder()-b.getOrder()}e={bot:1,member:0,non_member:2,place:3};return e[c]-e[d]},viewProps:{bot:{aux:(c=e)!=null?(c=c.group_mentions_sections_info)!=null?c.bot_aux:c:c,title:(c=e)!=null?(c=c.group_mentions_sections_info)!=null?c.bot_title:c:c},member:{aux:(c=e)!=null?(c=c.group_mentions_sections_info)!=null?c.member_aux:c:c,title:(c=e)!=null?(c=c.group_mentions_sections_info)!=null?c.member_title:c:c},nonMember:{aux:(c=e)!=null?(c=c.group_mentions_sections_info)!=null?c.nonmember_aux:c:c,title:(c=e)!=null?(c=c.group_mentions_sections_info)!=null?c.nonmember_title:c:c}}},upgradedPluginResource:b("JSResource")("createUpgradedUFI2GroupMentionsComposerPlugin").__setRef("LiveFeedStoryUFIRenderer.react")}):b("createUFI2MentionsComposerPlugin")({maxResults:5,mentions_datasource_js_constructor_args_json:g,typeaheadViewProps:{},upgradedPluginResource:b("JSResource")("createUpgradedUFI2MentionsComposerPlugin").__setRef("LiveFeedStoryUFIRenderer.react")}),b("createUFI2HashtagComposerPlugin")(),b("gkx")("678369")?b("createUFI2DelightsComposerPlugin")({size:10}):null].concat(b("createUFI2EmojiComposerPlugin")({size:16}),[b("createUFI2EmoticonsComposerPlugin")({size:16}),a.feedback.can_viewer_comment_with_photo===!0&&a.feedback.can_viewer_comment_with_video===!0?b("createUFI2MediaUploadComposerPlugin")({feedback:{viewer_actor:f}}):null],a.feedback.can_viewer_comment_with_gif===!0?b("createUFI2GIFComposerPlugin")({ftentidentifier:a.feedback.id}):[],a.feedback.can_viewer_comment_with_sticker===!0?b("createUFI2StickersComposerPlugin")({environment:i,targetID:(e=d)!=null?(e=e.owning_profile)!=null?e.id:e:e}):[],d.can_viewer_comment_with_stars===!0?b("createUFI2StarsComposerPlugin")({environment:i,feedbackID:(c=d)!=null?c.id:c}):[],[b("createUFI2LiveTypingBroadcastComposerPlugin")({feedback:a.feedback,relayEnvironment:i}),b("createUFI2PrefillMentionComposerPlugin")(),b("createUFI2AssociateReplyWithParentComposerPlugin")(),b("createUFI2SetReplyClickedComposerPlugin")()]).filter(Boolean)},editingCommentID:null,maybeCodedError:null,mirroredCurrentActor:h,mirroredMentionsDataSourceJSON:g}}d=function(a){babelHelpers.inheritsLoose(c,a);function c(){var c,d;for(var e=arguments.length,f=new Array(e),g=0;g<e;g++)f[g]=arguments[g];return(c=d=a.call.apply(a,[this].concat(f))||this,d.$1=null,d.$2=new(b("SubscriptionsHandler"))(),d.state=A(d.props),d.$3=function(a){if(a.feedback_reaction===0)return a;var b=d.$4();if(b!=null){return babelHelpers["extends"]({},a,{time_anchor:{time:b,type:((b=d.props.feedback.associated_video)==null?void 0:b.is_live_streaming)===!0?"LIVE_VIDEO":"ON_DEMAND_VIDEO"}})}return a},d.$5=function(){var a=d.props.feedback,c=a.id;a=a.subscription_target_id;return c!=null&&a!=null?b("UFI2FeedbackCommentReactSubscription").subscribe(z(d.state.mirroredCurrentActor),{top_level_feedback_id:c},d.props.useDefaultActor,a,d.context.isComet):null},d.$6=function(){var a=d.props.feedback,c=a.id;a=a.subscription_target_id;return c!=null&&a!=null?b("UFI2FeedbackReactSubscription").subscribe(z(d.state.mirroredCurrentActor),{feedback_id:c},d.props.useDefaultActor,a):null},d.$7=function(){d.$1&&d.$1.Actions.toggleList({focusComposer:!1})},d.$8=function(a){d.$1?(d.$1.Actions.expandList({focusComposer:!0,scrollToComposer:!0}),a.preventDefault()):b("FBLogger")("ufi2").addMetadata("UFI","FEEDBACK_TARGET_ID",d.props.feedbackTargetID||"UNKNOWN").mustfix("The 'comment' button was clicked but no comments list ref could be found. That ref is needed to make sure the comments list is open.")},d.$9=function(){d.$1&&d.$1.Actions.expandList({focusComposer:!0,scrollToComposer:!0})},d.$10=n.createRef(),d.$11=function(a){var c=a.actorID,e=a.clientID,f=a.commentData,g=a.entitiesByID,h=a.environment,i=a.feedLocation,j=a.feedbackSource,k=a.focusCommentID,l=a.getTrackingDataFn,m=a.topLevelFeedbackID;a=a.useDefaultActor;if(!f)return;var n=d.$4(),o=function(a,c){var d=b("VideoTimestampedCommentsConnectionHandler").getConnection(a,"LiveFeedStoryLiveStreaming_video_timestamped_comments");d!=null&&b("edgeIsInConnection")(d,c)===!1&&b("VideoTimestampedCommentsConnectionHandler").insertEdge(d,c);d=s.getConnection(a,"LiveFeedStoryCowatchingCommentList_top_level_comments");d!=null&&b("edgeIsInConnection")(d,c)===!1&&s.insertEdgeBefore(d,c)};b("UFI2CreateCommentMutation").commit({actorID:c,clientID:e,containerMapping:b("nullthrows")((c=d.context)==null?void 0:c.containerMapping),entitiesByID:g,environment:h,feedLocation:i,feedbackSource:j,focusCommentID:k,input:babelHelpers["extends"]({},f,b("getCommentCreateMutationPropertiesFromTrackingData")(l),(e={},e[((c=d.props.feedback)==null?void 0:(g=c.associated_video)==null?void 0:g.is_live_streaming)===!0?"live_video_timestamp":"vod_video_timestamp"]=n,e)),isComet:d.context.isComet,onError:d.$12,topLevelFeedbackId:m,triggerAccessibilityAlert:null,updater:o,useDefaultActor:a})},d.$13=function(){d.setState(function(a){return a.maybeCodedError==null?null:{maybeCodedError:babelHelpers["extends"]({},a.maybeCodedError,{acknowledged:!0})}})},d.$12=function(a){d.setState({maybeCodedError:{acknowledged:!1,error:a}})},d.$14=function(a){d.setState({editingCommentID:a})},d.$15=function(a){var c=a.comment;a=a.feedback;a=a==null?void 0:(a=a.associated_video)==null?void 0:a.id;if(a==null)return;var e=b("UFIVideoPlayerRegistry").findVideoPlayerControllerForElement(d.$10.current,a);if(e==null)return;var f=e.getVideoURL();if(f==null)return;d.$2.addSubscriptions(b("Bootloader").loadModules(["TahoeController","URI"],function(a,b){b=new b(f).setQueryData({comment_id:c.legacy_fbid,ref:"tahoe"});a.openFromVideoPlayer(e,b,null,null,"live_video_reply_click",e.getPlayerOrigin(),e.getPlayerSuborigin())},"LiveFeedStoryUFIRenderer.react"))},c)||babelHelpers.assertThisInitialized(d)}c.getDerivedStateFromProps=function(a,b){var c,d=b.mirroredCurrentActor;b=b.mirroredMentionsDataSourceJSON;var e=a.feedback;return((c=e)!=null?(c=c.viewer_actor)!=null?c.id:c:c)!==d||e.mentions_datasource_js_constructor_args_json!==b?A(a):null};var d=c.prototype;d.componentWillUnmount=function(){this.$2.release()};d.$4=function(){var a;a=(a=this.props.feedback)==null?void 0:(a=a.associated_video)==null?void 0:a.id;if(a==null||this.$10.current==null)return;a=b("UFIVideoPlayerRegistry").getAvailableVideoPlayerControllerTimeForElement(this.$10.current,a);if(a==null)return;return Math.floor(a)};d.render=function(){var a=this,c=this.props,d=c.displayCommentsContext,e=c.feedLocation,f=c.feedback,g=c.feedbackSource,h=c.feedbackTargetID,i=c.group,j=c.focusCommentID,k=c.onActorChange,l=c.shareableConfig,m=c.streamLastViewTime,o=c.storyRenderLocation,p=c.useDefaultActor;c=this.state;var q=c.composerPluginProps,r=c.editingCommentID;c=c.maybeCodedError;var s={composerPluginProps:q,editingCommentID:r,feedLocation:e,feedback:f,feedbackSource:g,feedbackTargetID:h,focusCommentID:j,isCommentFresh:function(a){return y({comment:a,feedLocation:e,group:i,streamLastViewTime:m})},onAddCommentClick:this.$9,onCommentReply:this.$15,onCommitCommentCreate:this.$11,onEditCommentError:this.$12,setEditingCommentID:this.$14,storyRenderLocation:o,useDefaultActor:p};return n.jsxs("div",{ref:this.$10,children:[n.jsx(b("UFI2RealtimeRoot.react"),{enabled:f.is_eligible_for_real_time_updates===!0,children:n.jsx(b("UFI2RealtimeContainer.react"),{subscribe:this.$5,children:n.jsx(b("UFI2CommentsList.react"),{displayCommentsContext:d,feedLocation:e,feedback:f,feedbackSource:g,focusCommentID:j,listRef:function(b){a.$1=b},useDefaultActor:p,children:function(c){var d;return n.jsxs(n.Fragment,{children:[n.jsx(b("UFI2RealtimeContainer.react"),{subscribe:a.$6,children:n.jsx(B,{feedback:f,feedbackSource:g,feedbackTargetID:h,mutationInputAugmenter:a.$3,onActorChange:k,onClickCommentsCount:a.$7,onCommentClick:a.$8,shareableConfig:l,useDefaultActor:p})}),(f==null?void 0:(d=f.associated_video)==null?void 0:d.is_live_streaming)===!0?n.jsx(E,babelHelpers["extends"]({commentsListRenderProps:c},s)):n.jsx(F,babelHelpers["extends"]({commentsListRenderProps:c},s))]})}})})}),c&&n.jsx(b("UFI2LazyCodedErrorDialog.react"),{error:c.error,onHide:this.$13,shown:c.acknowledged===!1})]})};return c}(n.Component);d.displayName="LiveFeedStoryUFIRenderer";d.contextType=b("UFI2SurfaceContainerContext");function B(a){var c=a.feedback,d=a.feedbackTargetID,e=a.feedbackSource,f=a.mutationInputAugmenter,g=a.onActorChange,h=a.onCommentClick,i=a.onClickCommentsCount,j=a.shareableConfig;a=a.useDefaultActor;i=n.jsxs(n.Fragment,{children:[n.jsx(b("FeedStoryUFISummary.react"),{feedback:c,onClickCommentsCount:i}),n.jsxs("div",{className:"_6w18",children:[c.can_see_voice_switcher===!0?n.jsx(b("UFI2ActorSelector.react"),{className:"_6w1g",feedback:c,onActorChange:g}):null,n.jsxs("div",{className:"_6w1h",children:[c.can_viewer_react===!0&&n.jsx(b("UFI2ReactionActionLink.react"),{enableAnimations:!0,feedback:c,feedbackSource:e,mutationInputAugmenter:f,useDefaultActor:a}),c.can_viewer_comment===!0&&n.jsx(b("UFI2CommentActionLink.react"),{onClick:h}),n.jsx(b("UFI2ShareActionLink.react"),{feedback:c,feedbackTargetID:d,shareableConfig:j}),n.jsx(b("UFI2PrivateReplyActionLink.react"),{feedback:c,feedbackSource:e,seeResponseLabel:!1})]})]})]});return x(e)?n.jsx(b("UFI2ScrollHoldingContainer.react"),{children:i}):i}function C(a){var c=a.enabled,d=a.element,e=a.feedback,f=a.viewOption,g=a.setViewOption,h=p(!1),i=p(null),j=e==null?void 0:(a=e.associated_video)==null?void 0:a.id,k=e==null?void 0:(a=e.viewer_actor)==null?void 0:a.id;o(function(){if(!c)return;b("promiseDone")(r(z(k),b("LiveFeedStoryLiveStreamingCommentList.react").query,{feedbackID:e==null?void 0:e.id}).then(function(a){i.current=a==null?void 0:(a=a.feedback)==null?void 0:(a=a.video_timestamped_comments)==null?void 0:(a=a.edges[0])==null?void 0:(a=a.node)==null?void 0:a.timestamp_in_video}))},[k,c,e]);o(function(){return function(){h.current=!0}},[f]);b("useInterval")(function(){if(h.current||j==null||d.current==null||!c)return;var a=b("UFIVideoPlayerRegistry").getAvailableVideoPlayerControllerTimeForElement(d.current,j);if(a==null)return;i.current!=null&&a>i.current&&g({viewOption:"LIVE_STREAMING"})},1e3,[d,j,c])}function D(a){var c,d=a.commentsListRenderProps,e=a.composerPluginProps,f=a.feedback,g=a.onCommitCommentCreate,h=a.editingComment,j=a.setEditingComment,k=a.feedbackSource,l=a.onEditCommentError;a=a.storyRenderLocation;d.depth===0||i(0,2951);var m=d.Selectors,o=d.depth,p=d.getComposerProps,q=d.listState,r=d.viewOption,s=m.isComposerVisible({depth:o,state:q});r=b("UFI2ViewOption").isChronologicalOrder(r);m=m.getVisibleCommentsCount({depth:o,state:q});q=f==null?void 0:f.viewer_actor;c=(c=f)!=null?c.constituent_badge_banner_link:c;if(h){var t=h.id;if(t==null){b("FBLogger")("ufi2").mustfix("Editing comment ID is null, this was served from GraphQL so we should investigate why this is the case, trace value of comment { id }");return null}return n.jsx(n.Suspense,{fallback:null,children:n.jsx(w,babelHelpers["extends"]({},e,d.getCommentEditorProps(),{comment:h,commentId:t,depth:0,feedbackSource:k,onError:l,onFinishEdit:function(){return j(null)},storyRenderLocation:a}))})}d=f.can_viewer_comment===!0;return f.have_comments_been_disabled===!0||f.is_viewer_muted===!0?n.jsx(b("UFI2CommentDisabledNotice.react"),{feedback:f}):s&&d&&q!=null?n.jsxs(n.Fragment,{children:[c!=null?n.jsx(v,{bootloadPlaceholder:n.jsx("div",{className:"_3-8t",children:n.jsx(b("XUISpinner.react"),{})}),uri:c}):null,n.createElement(b("UFI2Composer.react"),babelHelpers["extends"]({},e,p(),{actor:q,className:"_6w1l _6w1m"+(m===0?" _6w1n":"")+(!r&&m>0?" _6w1o":"")+" clearfix",commentAction:"ADD",depth:o,key:"composerForUID"+((h=q.id)!=null?h:"UNKNOWN"),onCommit:g}))]}):null}function E(a){var c=a.feedback,d=a.feedbackSource,e=a.feedLocation,f=a.storyRenderLocation,g=a.useDefaultActor,h=a.onCommentReply,i=q(null),j=i[0];i=i[1];return n.jsxs(n.Fragment,{children:[n.jsx(D,babelHelpers["extends"]({},a,{editingComment:j,setEditingComment:i})),c.id==null?null:n.jsx(b("LiveFeedStoryCowatchingCommentList.react"),{environment:b("RelayUFI2Environment").forActor((a=c.viewer_actor)==null?void 0:a.id),feedback:c,feedbackSource:d,feedLocation:e,fetchAnnouncementsForSurface:"POST",filterPinnedComment:!0,maxShownComments:m,onEdit:i,onReply:h,reverseList:!1,showPinnedComment:!0,storyRenderLocation:f,useDefaultActor:g})]})}function F(a){var c,d=a.commentsListRenderProps,e=a.composerPluginProps,f=a.editingCommentID,g=a.feedback,j=a.feedbackSource,k=a.feedbackTargetID,l=a.isCommentFresh,m=a.focusCommentID,o=a.onAddCommentClick,r=a.onCommentReply,s=a.onCommitCommentCreate,v=a.onEditCommentError,y=a.setEditingCommentID,A=a.storyRenderLocation,B=a.useDefaultActor,E=b("useUFIVPVDEndpoint")(),F=q(null),H=F[0];F=F[1];var I=d.Actions.setViewOption,J=d.Selectors,K=d.depth,L=d.getCommentEditorProps,M=d.getCommentProps,N=d.getFilterWarningPropsForOlderComments,O=d.getHiddenCommentsPlaceholderProps,P=d.getPagerPropsForNewerComments,Q=d.getPagerPropsForOlderComments,R=d.getPaginationProgressProps,S=d.getNestedCommentsListProps,T=d.listState,aa=d.onCommentsListMouseEnter,ba=d.onCommentsListMouseLeave,U=d.totalCount,V=d.viewOption;K===0||i(0,2951);d=p(null);var W=A==="permalink"||A==="group_permalink";C({element:d,enabled:W&&U>5,feedback:g,setViewOption:I,viewOption:V});W=J.hasPagedInDirection({depth:K,direction:"forward",state:T});var X=b("UFI2ViewOption").isChronologicalOrder(V),Y=J.isListExpanded({depth:K,state:T}),Z=J.isListLoading({depth:K,state:T});c=(c=(c=g.unfiltered_comment_count)==null?void 0:c.total_count)!=null?c:U;U=c>0&&(g.num_localized_comment_orderings||0)>1;c=J.getVisibleCommentsCount({depth:K,state:T});if(!Y)return null;if(Y&&c===0&&Z)return n.jsx("div",{className:"_6w1i _6w1j",children:n.jsx(b("XUISpinner.react"),{className:"_6w1k",size:"large"})});Y=J.getVisibleCommentsWithHiddenCommentsCollapsed({depth:K,reverse:X,state:T});var $=(Z=g)!=null?Z.viewer_actor:Z;Z=g.can_viewer_comment===!0;Z&&!$&&b("FBLogger")("ufi2").addMetadata("UFI","FEEDBACK_TARGET_ID",k||"UNKNOWN").mustfix("FeedStoryUFI: Cant render composer without actor");Z=n.jsx(D,babelHelpers["extends"]({},a,{editingComment:H,setEditingComment:F}));k=V==="LIVE_STREAMING";a=k?null:n.jsx(b("UFI2CommentsPager.react"),babelHelpers["extends"]({},P(),{className:"_6w1p"}));H=k?null:n.jsx(b("UFI2CommentsPager.react"),babelHelpers["extends"]({},Q(),{className:"_6w1p"}));P=!X&&Z&&W&&!k;Q=J.isPagerVisible({depth:K,direction:"forward",state:T})&&!k?n.jsx(b("UFI2PaginationProgressIndicator.react"),babelHelpers["extends"]({},R(),{className:"_6w1p"})):null;W=n.jsxs("div",{className:"_6w1i","data-testid":void 0,onMouseEnter:aa,onMouseLeave:ba,ref:d,children:[n.jsx("h6",{className:"accessible_elem",children:h._("Comments")}),n.jsxs("div",{className:"_6w1q _77bf",children:[X?H:a,U?n.jsx("div",{className:"_6w1r",children:n.jsx(b("UFI2ViewOptionsSelector.react"),{alignh:"left",caretClassName:"_6w1t",className:"_6w1u",feedback:g,linkClassName:"_6w1v",onChange:function(a){return I({viewOption:a})},selectedViewOption:V})}):X?Q:null]}),!X&&Z,n.jsx(b("LiveFeedStoryPinnedComment.react"),{environment:z($==null?void 0:$.id),feedback:g,feedbackSource:j,onEdit:F,storyRenderLocation:A,useDefaultActor:B}),V==="LIVE_STREAMING"?n.jsx(b("LiveFeedStoryLiveStreamingCommentList.react"),{environment:z($==null?void 0:$.id),feedbackSource:j,onEdit:F,onReply:r,storyRenderLocation:A,variables:{feedbackID:g.id,scale:t,useDefaultActor:B}}):c>0?n.jsx("ul",{className:"_77bg",children:Y.map(function(a,c){if(a.state==="COLLAPSED"){var d;return n.jsx("li",{children:n.jsx(b("UFI2HiddenCommentsPlaceholder.react"),babelHelpers["extends"]({},O(),{className:"_6w1l"+(c===0?" _77bh":""),commentIDs:a.comments.map(function(a){return a.id})}))},"hidden-"+((d=(d=a.comments[0])==null?void 0:d.id)!=null?d:c))}else if(a.state==="VISIBLE")return n.jsx(n.Fragment,{children:a.comments.map(function(a,d){var h=a.id,i=a.optimistic_action==null&&a.optimistic_error==null,k=M(a);d=n.jsx(b("UFI2Comment.react"),babelHelpers["extends"]({},k,{className:"_6w1l"+(d===0&&c===0?" _77bh":"")+" clearfix",feedbackSource:j,isCommentFresh:l,isHighlighted:b("isCommentTokenOrFBID")(m,a),logCommentViewportViewDuration:i?function(a,c,d){b("logCommentViewportViewDuration")(babelHelpers["extends"]({commentID:h,endpoint:E,isLivePinnedComment:!1,isReply:!1,milliseconds:c,storyRenderLocation:A},b("getViewportViewDurationPropertiesFromTrackingData")(d),{visibleStartTime:a}))}:null,onEdit:function(){return y(h)},storyRenderLocation:A}));return n.jsxs("li",{children:[h===f?n.jsx(n.Suspense,{fallback:n.jsx("div",{"aria-busy":"true",className:"aero",children:d}),children:n.jsx(w,babelHelpers["extends"]({},e,L(),{comment:a,commentId:h,depth:0,feedbackSource:j,onError:v,onFinishEdit:function(){return y(null)},storyRenderLocation:A}))}):d,n.jsx(b("UFI2CommentsList.react"),babelHelpers["extends"]({},S(h),{children:function(a){return n.jsx(G,{composerPluginProps:e,currentActor:$,editingCommentID:f,feedback:g,feedbackSource:j,focusCommentID:m,isCommentFresh:l,onCommitCommentCreate:s,onEditCommentError:v,repliesListRenderProps:a,setEditingCommentID:y,storyRenderLocation:A,topLevelViewOption:V,vpvdEndpoint:E})}}))]},k.key||h)})},c);return null})}):null,V==="RANKED_THREADED"&&n.jsx(b("UFI2CommentsFilterFallbackWarning.react"),babelHelpers["extends"]({},N(),{className:"_6w1l"})),n.jsxs("div",{className:"_6w1q _77bi",children:[X?a:H,X?null:Q]}),n.jsx(b("UFI2TypingIndicator.react"),{feedback:g}),X&&Z,P===!0&&n.jsx(u,{bootloadPlaceholder:n.jsx("div",{className:"_6w1w"}),onClick:o})]});return x(j)?n.jsx(b("UFI2ScrollHoldingContainer.react"),{children:W}):W}var G=function(c){babelHelpers.inheritsLoose(a,c);function a(){return c.apply(this,arguments)||this}var d=a.prototype;d.render=function(){var a=this.props,c=a.composerPluginProps,d=a.currentActor,e=a.editingCommentID,f=a.vpvdEndpoint,g=a.feedbackSource,h=a.isCommentFresh,j=a.focusCommentID,k=a.onCommitCommentCreate,l=a.onEditCommentError,m=a.repliesListRenderProps,o=a.setEditingCommentID,p=a.storyRenderLocation;a=a.topLevelViewOption;m.depth===1||i(0,2952);var q=m.Selectors,r=m.depth,s=m.getCommentEditorProps,t=m.getCommentProps,u=m.getComposerProps,v=m.getFilterWarningPropsForOlderComments,y=m.getFilterWarningPropsForNewerComments,z=m.getHiddenCommentsPlaceholderProps,A=m.getPagerPropsForNewerComments,B=m.getPagerPropsForOlderComments,C=m.getRepliesCollapserProps,D=m.getRepliesExpanderProps,E=m.listState,F=m.onCommentsListMouseEnter;m=m.onCommentsListMouseLeave;var G=q.getVisibleCommentsWithHiddenCommentsCollapsed({depth:r,reverse:!0,state:E}),H=q.isComposerVisible({depth:r,state:E}),I=q.isListExpanded({depth:r,state:E}),J=q.isRepliesExpanderLoading({depth:r,state:E});q=q.getVisibleCommentsCount({depth:r,state:E});I=!I||J?n.jsx(b("UFI2RepliesExpander.react"),babelHelpers["extends"]({},D(),{className:"_6w1x _6w1p"})):n.jsxs(n.Fragment,{children:[n.jsx(b("UFI2RepliesCollapser.react"),babelHelpers["extends"]({},C(),{className:"_6w1y"})),n.jsx(b("UFI2CommentsPager.react"),babelHelpers["extends"]({},B(),{className:"_6w1x _6w1p"})),a==="RANKED_THREADED"&&n.jsx(b("UFI2CommentsFilterFallbackWarning.react"),babelHelpers["extends"]({},v(),{className:"_6w1z clearfix",viewOption:a})),q>0?n.jsx("ul",{children:G.map(function(a,d){if(a.state==="COLLAPSED"){var i;return n.jsx("li",{children:n.jsx(b("UFI2HiddenCommentsPlaceholder.react"),babelHelpers["extends"]({},z(),{className:"_6w1l",commentIDs:a.comments.map(function(a){return a.id})}))},"hidden-"+((i=(i=a.comments[0])==null?void 0:i.id)!=null?i:d))}else if(a.state==="VISIBLE")return n.jsx(n.Fragment,{children:a.comments.map(function(a){var d=a.id,i=a.optimistic_action==null&&a.optimistic_error==null,k=t(a);i=n.jsx(b("UFI2Comment.react"),babelHelpers["extends"]({},k,{className:"_6w1z clearfix",feedbackSource:g,isCommentFresh:h,isHighlighted:b("isCommentTokenOrFBID")(j,a),logCommentViewportViewDuration:i?function(a,c,e){b("logCommentViewportViewDuration")(babelHelpers["extends"]({commentID:d,endpoint:f,isLivePinnedComment:!1,isReply:!0,milliseconds:c,storyRenderLocation:p},b("getViewportViewDurationPropertiesFromTrackingData")(e),{visibleStartTime:a}))}:null,onEdit:function(){return o(d)},storyRenderLocation:p}));return n.jsx("li",{children:d===e?n.jsx(n.Suspense,{fallback:n.jsx("div",{"aria-busy":"true",className:"aero",children:i}),children:n.jsx(w,babelHelpers["extends"]({},c,s(),{comment:a,commentId:d,depth:1,onError:l,onFinishEdit:function(){return o(null)},storyRenderLocation:p}))}):i},k.key||d)})},d);return null})}):null,a==="RANKED_THREADED"&&n.jsx(b("UFI2CommentsFilterFallbackWarning.react"),babelHelpers["extends"]({},y(),{className:"_6w1z clearfix",viewOption:a})),n.jsx(b("UFI2CommentsPager.react"),babelHelpers["extends"]({},A(),{className:"_6w1x _6w1p"})),H&&d!=null?n.createElement(b("UFI2Composer.react"),babelHelpers["extends"]({},c,u(),{actor:d,className:"_6w1-",commentAction:"ADD",depth:r,key:"composerForUID"+((E=d.id)!=null?E:"UNKNOWN"),onCommit:k})):null]});I=n.jsx("div",{className:"_6w1_","data-testid":void 0,onMouseEnter:F,onMouseLeave:m,children:I});x(g)&&(I=n.jsx(b("UFI2ScrollHoldingContainer.react"),{children:I}));return I};return a}(n.Component);e.exports=c(d,{feedback:j!==void 0?j:j=b("LiveFeedStoryUFIRenderer_feedback.graphql"),group:k!==void 0?k:k=b("LiveFeedStoryUFIRenderer_group.graphql"),shareableConfig:l!==void 0?l:l=b("LiveFeedStoryUFIRenderer_shareableConfig.graphql")})}),null);